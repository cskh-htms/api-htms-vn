
<% if( typeof title == 'string' && title){ title = title } else{ title="" } %>


<% include ../../masterpage/loader %>

<script src="../../../../../../<%= js_css_version %>/javascripts/class-discount-program-speciality.js"></script>	


<div id="page_wrap" class="page_wrap">
<div id="layout" class="page_width layout">
<div id="content-wrap" class="content_wrap">
<!-- --------------------
page wrap 
--------------------- -->
<% include ../../masterpage/header %>
<% include ../../masterpage/function-share-all %>
<% include ../../masterpage/function-share-discount %>


<script>
	console.log(<%- JSON.stringify({"datas_info" : datas_info}) %>);
</script>	







<% //neu admin thi hien muc nay
var	enable_text = " disabled " ;
var	enable_text2 = " " ;
var	enable_text3 = " disabled " ;

if(user_role =="admin"){ 
	enable_text3 = "" ;
	enable_text2 = " disabled "
}

%>






<!-- --------------------
content
--------------------- -->
<div id="content" class="content">

	<h1><a href="/stores/manage/<%= store_id %>/<%= user_id %>"><%= store_name %></a><i class="fas fa-chevron-right"></i>
	<a href="/discount-program/speciality/<%= store_id %>">Chương trình khuyến mãi</a><i class="fas fa-chevron-right"></i>Sản phẩm tham gia chương trình khuyến mãi</h1>
	
	<div class="pro_content_edit">
		<div class="pro_col01">
		
	
			<div class="pro_box ten_sp_box">
				<h3>Sản phẩm tham gia khuyến mãi
					<span class="giai-thich">
					<span>
						Chọn một sản phẩm tham gia khuyến mãi
					</span>
					</span>					
				</h3>
				
				<%
				if(typeof products_list == 'object' && products_list.length > 0){  %>
				
					<div class="inside">
						<select name="cars" id="discount_program_product_link_product_speciality_id">
							   <option value="0">Chọn sản phẩm</option>
							   <%
							   for(var x in products_list){
							   %>
								<option 
								value="<%= products_list[x].products_speciality_ID %>" 
								data_price="<%= products_list[x].products_speciality_price %>" 
								data_sale_of_price="<%= products_list[x].products_speciality_sale_of_price %>" 
								>
									<%- ojs_share.unCape(products_list[x].products_speciality_name) -%>
								</option>
							    <%
								} //end of for
								%>
						</select>
					</div>
					<div id="price-wrap" style="display:none;">
					<div class="inside">
						<span>Giá gốc</span><br>
						<input id="products_speciality_price"  disabled 
						type="text" class="number_change" 
						data_value="0" 
						value="0"/>
					</div>					
					
					<div class="inside">
						<span>Giá khuyến mãi</span><br>
						<input id="products_speciality_sale_of_price" 
						type="text" class="number_change" 
						data_value="0" 
						value="0"/>
					</div>	
					</div>
				
				<%
				}else{
				%>
					<h1> Cửa hàng chưa có sản phẩm nào, Hẫy tạo sản phẩm
				<%
				}//end of typeof products_list
				%>

			</div>			
		
	
	
			<%
			//-------------------------
			// gift
			//-------------------------
			if(discount_program_details_tager[0].discount_program_gift_type == "1"){
				var gift_type = "display:block;"
			}else{
				var gift_type = "display:none;"
			}
			%>
			
			
			
			<div class="pro_box ten_sp_box" id="gift_list" style="<%- gift_type %>">
				<h3>Sản phẩm quà tặng
					<span class="giai-thich">
					<span>
						Chọn một sản phẩm quà tặng kèm sản phẩm này
					</span>
					</span>					
				</h3>
				
				<%
				if(typeof products_list_gift == 'object' && products_list_gift.length > 0){  %>
				
					<div class="inside">
						<div id="select_gift_list">
							   <%
							   for(var x in products_list_gift){
							   %>
								<div class="gift-line"> 
								  <div class="gift_image">
									<img 
									class="gift-img" src="<%- ojs_share.unCape(products_list_gift[x].products_speciality_featured_image) -%>"
									/>
								  </div>								
								  <input type="checkbox" 
								  id="gift_line_<%= products_list_gift[x].products_speciality_ID %>" 
								  name="gift_line_name" 
								  class="gift_line_name" 
								  value="<%= products_list_gift[x].products_speciality_ID %>">
								  <label for="gift_line_<%= products_list_gift[x].products_speciality_ID %>">
									<%- ojs_share.unCape(products_list_gift[x].products_speciality_name) -%>
								  </label>	

								  
								</div>
							    <%
								} //end of for
								%>
						</div>
					</div>
				
				<%
				}else{
				%>
					<h1> Cửa hàng chưa có sản phẩm quà tặng nào
				<%
				}//end of typeof products_list
				%>

			</div>				
	
	
	
	
	
	
	
	

			
			<div class="pro_box ten_sp_box">
				<h3>Lời nhắn</h3>
				<div class="inside">
					<textarea class=""  id="discount_program_product_link_qoute"  rows="10" cols="100%"></textarea>
				</div>
			</div>				
			
			
		</div>
		<div class="pro_col02">

			<div class="pro_box ten_sp_box">
				<h3>Tên chương trình khuyến mãi</h3>
				<div class="inside">
					<input type="text" disabled class= "" value="<%- ojs_share.unCape(discount_program_details_tager[0].discount_program_name) -%>" id=""/>
				</div>
				<h3>Giới hạn ngày tham gia </h3>
				<div class="inside">
					<input type="text" disabled class= "" value="<%= discount_program_details_tager[0].discount_program_details_limit_day %>" id=""/>
				</div>				
				<h3>Giới hạn sản phẩm tham gia</h3>
				<div class="inside">
					<input type="text" disabled class= "" value="<%= discount_program_details_tager[0].discount_program_details_limit_product %>" id=""/>
				</div>	
				
			</div>	

			<div class="pro_box trang_thai_box ">
				<h3>Trạng thái admin</h3>
				<div class="inside">
					<span>ADMIN:</span><span class="giai-thich"><span>Yêu cầu tham gia chương trình phải được admin phê duyệt</span></span>
					<select id="discount_program_product_link_status" <%= enable_text3 %>>
						<%- ojs_share.show_status_select_share_all(0) -%>
					</select>						
				</div>
			</div>	
		
		
		</div>
	</div>
	
	<input 
		type="hidden"
		id="discount_program_product_link_date_star" 
		value="<%= ojs_share_all.format_date( discount_program_details_tager[0].discount_program_details_date_created ) %>"
	/>
	
	<% 
		var date_end = ojs_share_discount.caution_date_product_add(
			discount_program_details_tager[0].discount_program_details_date_created,
			discount_program_details_tager[0].discount_program_details_limit_day
		) 
	%>
	
	
	<input 
		type="hidden" 
		id="discount_program_product_link_date_end" 
		value="<%= ojs_share_all.format_date(date_end) %>"
	/>

<div class="btn_box">
	<a href="/discount-program/speciality/<%= store_id %>/" class="btn_back">Quay về</a>
	<button id="btn_save" class="btn_save">Đăng</button>
</div>	
	





<input type="hidden" id="user_id" value="<%= user_id %>"/>
<input type="hidden" id="store_id" value="<%= store_id %>"/>
<input type="hidden" id="gift_type_id" value="<%= discount_program_details_tager[0].discount_program_gift_type %>"/>
<input type="hidden" id="discount_program_details_id" value="<%= discount_program_details_id %>"/>


</div>
<!-- --------------------
end content
--------------------- -->





<% include ../../masterpage/footer %>

</div><!-- //content_wrap -->	


<% include ../../masterpage/sidebar %>

<!-- --------------------
//end of page wrap 
--------------------- -->
</div><!-- //layout -->	
</div><!-- //pagewrap -->


<script>
$(document).ready(function($){
/////////////////////////////////////////////////////	
	//
	
	var user_id = $('#user_id').val();
	var store_id = $('#store_id').val();
	var discount_program_details_id = $('#discount_program_details_id').val();
	
	//@
	//@
	//@
	//@
	$(document).on('click','#btn_save',function(e) {		
		e.preventDefault();
		var datas = get_datas();	
		
		//console.log(datas );
		//return;
		
		var gift_type_id = $('#gift_type_id').val();
		if(
		gift_type_id == 1 
		&& 
		datas.datas.gift_data.length < 1 
		)
		{
			ojs_message.message_ok_show("Chưa chọn sản phẩm quà tặng");
			return;	
		}
		
		
		
		var price = parseInt($('#products_speciality_price').attr('data_value'));

		if(
		gift_type_id == 0 
		&& 
		(datas.datas.discount_program_product_link_sale_of_price == ""  
		|| parseInt(datas.datas.discount_program_product_link_sale_of_price) >  price) 
		){
			ojs_message.message_ok_show("giá giảm không hợp lệ");
			return;			
		}
		
	
		
		if(datas.datas.discount_program_product_link_product_speciality_id == 0){
			ojs_message.message_ok_show("chưa chọn sản phẩm");
			return;
		}

	
		ojs_discount_program_speciality.ajax_save_product(datas);	
	});


	
	
	//@
	//@
	//@
	//@	
	function get_datas(){
		
		var product_id = $('#discount_program_product_link_product_speciality_id  option:selected').val();
		var discount_program_product_link_status = $('#discount_program_product_link_status  option:selected').val();
		var discount_program_product_link_qoute = $('#discount_program_product_link_qoute').val();
		
		var discount_program_product_link_date_star = $('#discount_program_product_link_date_star').val();
		var discount_program_product_link_date_end = $('#discount_program_product_link_date_end').val();
		
		var discount_program_product_link_sale_of_price = $('#products_speciality_sale_of_price').attr("data_value");
		
		
		var gift_type_id = $('#gift_type_id').val();
		if(	gift_type_id == 1 ){
			discount_program_product_link_sale_of_price = "";
		}		
		
		var gift_ojp = $('#select_gift_list').find('.gift_line_name');
		var gift_data = [];
		$(gift_ojp).each(function( index ) {
			if($(this).prop( "checked" )){
				gift_data.push($(this).val());
			}
		});		
		
		
		
		var datas = {
			"datas":{
				
				discount_program_product_link_discount_program_details_id : discount_program_details_id,
				discount_program_product_link_product_speciality_id : product_id,
				discount_program_product_link_status : discount_program_product_link_status,
				discount_program_product_link_qoute : discount_program_product_link_qoute,
				discount_program_product_link_sale_of_price : discount_program_product_link_sale_of_price,
				discount_program_product_link_date_star : discount_program_product_link_date_star,
				discount_program_product_link_date_end : discount_program_product_link_date_end,
				gift_data:gift_data
				
			}
		}
		
		return datas;
	}
	
	
	//@
	//@
	//@
	//@
	$(document).on('change','#discount_program_product_link_product_speciality_id',function(e) {		
		e.preventDefault();
		var product_id = $(this).find('option:selected').val();	
		var product_price = $(this).find('option:selected').attr("data_price");	
		var product_sale_of_price = $(this).find('option:selected').attr("data_sale_of_price");	
		
		var gift_type_id = $('#gift_type_id').val();
		console.log([gift_type_id, product_id,product_price,product_sale_of_price ]);
		

		if(gift_type_id == 1){
			$('#price-wrap').css('display','none');			
		}else{
			if( product_id == 0 ){
				$('#products_speciality_price').attr('data_value','0');
				$('#products_speciality_price').val('0');
				
				$('#products_speciality_sale_of_price').attr('data_value','0');
				$('#products_speciality_sale_of_price').val('0');
				$('#price-wrap').css('display','none');
			}else{
				$('#price-wrap').css('display','block');
				$('#products_speciality_price').attr('data_value',product_price);
				$('#products_speciality_price').val(ojs_loader.show_price_format(product_price,0,",",".",""));
				
				$('#products_speciality_sale_of_price').attr('data_value',product_sale_of_price);
				$('#products_speciality_sale_of_price').val(ojs_loader.show_price_format(product_sale_of_price,0,",",".",""));
			}
		}
	});
	
	
	
	
	
	

	//
	//
///////////////////////////////////////////////////////
});//end of document
</script>



<% include ../../masterpage/loader-end %>
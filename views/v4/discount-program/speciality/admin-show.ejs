

<% include ../../masterpage/loader %>
<link rel='stylesheet' href='/<%= js_css_version %>/stylesheets/share-menu-admin.css' />
<link rel='stylesheet' href='/<%= js_css_version %>/stylesheets/discount.css' />





<script src="../../../../../<%= js_css_version %>/javascripts/ojs-share-upload.js"></script>		
<script src="../../../../../<%= js_css_version %>/javascripts/class-discount-program-speciality-admin.js"></script>






<div id="page_wrap" class="page_wrap">
<div id="layout" class="page_width layout">
<div id="content-wrap" class="content_wrap">


<!-- --------------------
page wrap 
--------------------- -->



<% include ../../masterpage/header %>
<% include ../../masterpage/function-share-discount %>
<% include ../../masterpage/function-share-all %>
<% include ../../masterpage/function-share-all-admin %>


<script>
	console.log(<%- JSON.stringify({"datas_info" : datas_info}) %>);
</script>


<!-- --------------------
content
--------------------- -->
<div id="content" class="content">
	<h1><a href="/admin/">Admin</a><i class="fas fa-chevron-right"></i>Sửa chương trình khuyến mãi</h1>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	

</div>
<!-- --------------------
end content
--------------------- -->





<% include ../../masterpage/footer %>

</div><!-- //content_wrap -->	


<% //include ../../masterpage/sidebar %>

<!-- --------------------
//end of page wrap 
--------------------- -->
</div><!-- //layout -->	
</div><!-- //pagewrap -->


<script>
$(document).ready(function($){
/////////////////////////////////////////////////////	
	//
	
	var user_id = $('#user_id').val();
	var store_id = $('#user_id').val();
	var discount_program_id = $('#discount_program_id').val();
	
	
	$( "#discount_program_date_star" ).datepicker({
			dateFormat: "yy-mm-dd",
			timeFormat:  "hh:mm:ss",
			language: 'vi'
		}
	);
	$( "#discount_program_date_end" ).datepicker({
			dateFormat: "yy-mm-dd",
			timeFormat:  "hh:mm:ss",
			language: 'vi'
		}
	);


	//@
	ojs_loader.show_anh_dai_dien('featured_image','img_box_dai_dien',"","");
	//@
	//@
	
	//@
	$(document).on('click','#btn_featured_image',function(e) {		
		e.preventDefault();		
		$('#upload_image').trigger( "click" );
	});
	//@
	$("#upload_image").on("change",function(){
		let input = this;
		ojs_loader.upload_anh_dai_dien(input,"featured_image","img_box_dai_dien",user_id)
	});		
	//
	//xóa image dai dien
	$(document).on('click','.xoaAnhDaiDien',function(e) {		
		e.preventDefault();		
		
		
		// xoa image s3
		let products_speciality_featured_image = $('#featured_image').attr("data_value");
		let url = products_speciality_featured_image;
		
		//console.log(url);
		//return;
		
		
		//ojs_loader.delete_s3(url);
		ojs_loader.delete_wp(url);
		$('#featured_image').attr("data_value","");
		//xoa html
		$(this).parent(".img_box").remove();
		ojs_loader.set_value_anh_dai_dien('featured_image','img_box_dai_dien');
		
	});			
	//		
	//	
	$(document).on('change','#discount_program_time_type',function(e) {		
		e.preventDefault();
		var x = $(this).find("option:selected").val();
		if(x == 0){
			$('#thoi-han-khuyen-mai').css('display','none');
		}else{
			$('#thoi-han-khuyen-mai').css('display','block');
		}
	});		
	
	//@
	//@
	//@
	//@
	var store_id = $('#store_id').val();		
	$(document).on('click','#btn_draf',function(e) {		
		e.preventDefault();
		var datas = get_datas();	
		
		datas.datas.discount_program_status_admin = -1;
		
		//console.log(datas);
		//return;
		
		ojs_discount_program_speciality.ajax_update(datas,discount_program_id);	
	});
	
	//@
	//@
	//@
	//@
	$(document).on('click','#btn_save',function(e) {		
		e.preventDefault();
		
		var date_01 = $('#discount_program_date_star').datepicker( "getDate" );
		var discount_program_date_star = $.datepicker.formatDate("yy-mm-dd", date_01);

		
		var date_02 = $('#discount_program_date_end').datepicker( "getDate" );
		var discount_program_date_end = $.datepicker.formatDate("yy-mm-dd", date_02);		
		
		var discount_program_time_type = $('#discount_program_time_type  option:selected').val();		
		
		
		//console.log([discount_program_date_star,discount_program_date_end,discount_program_time_type]);
		//return;
		if(
		discount_program_time_type == 1
		&& (discount_program_date_star == "" 
		|| discount_program_date_end == "")
		){
			ojs_message.message_ok_show("Vui lòng chọn ngày khuyến mãi");
			return;
		}		
		
		
		var datas = get_datas();	
		//console.log(datas);
		//return;
		
		ojs_discount_program_speciality.ajax_update(datas,discount_program_id);	
	});


	
	
	function get_datas(){
		
		var discount_program_store_id_created = store_id;
		
		var discount_program_name = $('#discount_program_name').val();		
		var discount_program_qoute = $('#discount_program_qoute').val();		


		var discount_program_limit_product = $('#discount_program_limit_product').val();		
		var discount_program_limit_day = $('#discount_program_limit_day').val();


		var discount_program_price_created = $('#discount_program_price_created').attr("data_value");
		var discount_program_price_sale = $('#discount_program_price_sale').attr("data_value");
		var discount_program_price_one_day = $('#discount_program_price_one_day').attr("data_value");
		var discount_program_price_one_product = $('#discount_program_price_one_product').attr("data_value");	
		
		
		var discount_program_type = $('#discount_program_type  option:selected').val();		
		var discount_program_time_type = $('#discount_program_time_type  option:selected').val();
		var discount_program_gift_type = $('#discount_program_gift_type  option:selected').val();
		var discount_program_position = $('#discount_program_position  option:selected').val();
		var discount_program_status_admin = $('#discount_program_status_admin').val();
		
		
		var discount_program_information = $('#noi_dung').val();		
		var discount_program_featured_image = $('#featured_image').attr("data_value");		
		
		
		var date_01 = $('#discount_program_date_star').datepicker( "getDate" );
		var discount_program_date_star = $.datepicker.formatDate("yy-mm-dd", date_01);

		
		var date_02 = $('#discount_program_date_end').datepicker( "getDate" );
		var discount_program_date_end = $.datepicker.formatDate("yy-mm-dd", date_02);
		
		if(discount_program_date_end.length > 0){			
			discount_program_date_end = discount_program_date_end + " 23:59:59"
		}
		
		if(discount_program_name == "" ){
			ojs_message.message_ok_show("Chưa nhập tên chương trình");
		}

		
		
		let datas = {
			"datas":{
				discount_program_name:discount_program_name,
				discount_program_qoute:discount_program_qoute,
				discount_program_limit_product:discount_program_limit_product,
				discount_program_limit_day:discount_program_limit_day,
				discount_program_price_created:discount_program_price_created,
				discount_program_price_sale:discount_program_price_sale,
				discount_program_price_one_day:discount_program_price_one_day,
				discount_program_price_one_product:discount_program_price_one_product,
				discount_program_type:discount_program_type,
				discount_program_time_type:discount_program_time_type,
				discount_program_gift_type:discount_program_gift_type,
				discount_program_position:discount_program_position,
				discount_program_store_id_created:discount_program_store_id_created,
				
				discount_program_featured_image:discount_program_featured_image,
				discount_program_information:discount_program_information,
				discount_program_status_admin:discount_program_status_admin,
				discount_program_date_star:discount_program_date_star,
				discount_program_date_end:discount_program_date_end,
				
			}
		}
		
		return datas;
	}

	//
	//
///////////////////////////////////////////////////////
});//end of document
</script>



<% include ../../masterpage/loader-end %>	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
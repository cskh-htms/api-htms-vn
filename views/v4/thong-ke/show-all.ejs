<%-  include ("../masterpage/loader") %>
<link rel='stylesheet' href='/<%= js_css_version %>/stylesheets/share-menu-admin.css' />
<link rel='stylesheet' href='/<%= js_css_version %>/stylesheets/thong-ke.css' />


<script src="../../../<%= js_css_version %>/javascripts/ojs-share-date.js"></script>
<script src="../../../<%= js_css_version %>/javascripts/class-thong-ke-admin.js"></script>



<div id="page_wrap" class="page_wrap">
<div id="layout" class="page_width layout">
<div id="content-wrap" class="content_wrap">
<!-- --------------------
page wrap 
--------------------- -->
<%- include("../masterpage/header") %>
<% include ("../masterpage/function-share-all-admin") %>
<% include ("../masterpage/function-share-orders") %>

<script>
	console.log(<%- JSON.stringify({"datas_info" : datas_info}) %>);
</script>	


<!-- --------------------
//content
--------------------- -->

<div id="content" class="content">
	<h1><%= title %></h1>



	<div class="loc-wrap">	

		<div class="loc-wrap-inner">
			<p>Lọc theo cửa hàng</p>
			<select id="loc_by_store"">
				<option value="all"></option>
				<% 
				if( store_list.length > 0){
				for(x in store_list){
				%>	
					<option value="<%= store_list[x].stores_ID %>">
						<%= store_list[x].stores_name %>
						( <%= store_list[x].stores_phone %> )
					</option>
				<%
				}
				}
				%>	
			</select>
		</div>	

	
		<div class="loc-wrap-inner">
			<p>Lọc theo trạng thái đơn hàng</p>
			<select id="loc_order_status"">
				<option value="all"></option>
				<option value="1">Đã hoàn thành</option>
				<option value="2">Chưa hoàn thành</option>
			</select>
		</div>	


		<div class="loc-wrap-inner">
			<p>Lọc theo trạng thái công nợ</p>
			<select id="loc_cong_no"">
				<option value="all"></option>
				<option value="1">Đã thanh toám</option>
				<option value="2">Chưa thanh toán</option>
			</select>
		</div>			
	</div>	


	<div class="report_wrap">
		<div class="report_bock report_bock_order">
			<ul class="report_link_box">
				<li class="one report_link">
					<a href="#"  class="report_active"  data_send="tat_ca">Tất cả</a>
				</li>			
			
				<li class="one report_link">
					<a href="#"  class=""  data_send="thang_nay">Tháng này</a>
				</li>
				
				<li class="one report_link">
					<a href="#" class="" data_send="hom_nay">Hôm nay</a>
				</li>
				<li class="one report_link" >
					<a href="#"  data_send="hom_qua">Hôm qua</a>
				</li>				
				<li class="one report_link">
					<a href="#" data_send="tuan_nay">Tuần này</a>
				</li>
				
			</ul>
			<div class="custom_date">Từ ngày: <input type="text" id="datepicker" > đến ngày <input type="text" id="datepicker2" ><button id="btn_date">Xem</button></div>
			<ul class="reset_box">
					<li>
						<a href="/admin/thong-ke/"  data_send="" class="">Đặt lại</a>
					</li>				
					
				</ul>
		</div>
		
	</div>




	<div id="ajax-wrap">
	<%- include ("../masterpage/widget-thong-ke-admin-show-all") %>
	</div>





	
</div>
<!-- --------------------
end content
--------------------- -->





<% include("../masterpage/footer") %>

</div><!-- //content_wrap -->	


<%-  include("../masterpage/sidebar") %>

<!-- --------------------
//end of page wrap 
--------------------- -->
</div><!-- //layout -->	
</div><!-- //pagewrap -->






<script>
	$(document).ready(function(){
	//////////////////////////////////////////////
		
	$( "#datepicker" ).datepicker({
			dateFormat: "yy-mm-dd",
			timeFormat:  "hh:mm:ss",
			language: 'vi'
		}
	);
	$( "#datepicker2" ).datepicker({
			dateFormat: "yy-mm-dd",
			timeFormat:  "hh:mm:ss",
			language: 'vi'
		}
	);
	

	//@
	//@
	//xoa
	$(document).on('click','#btn_date',function(e) {	
	
		var date_01 = $( "#datepicker" ).datepicker( "getDate" );
		var date_02 = $( "#datepicker2" ).datepicker( "getDate" );

		
		if(date_01 == null || date_02 == null){
			ojs_message.message_ok_show("vui lòng chọn ngày");
			return;
		}
	
		//
		//
		$(this).parents('#content').find(".report_wrap").find("a").removeClass("report_active");
		$(this).addClass("report_active");
		//@
		e.preventDefault();		
		var date_01 = $( "#datepicker" ).datepicker( "getDate" );
		var date_01_ok = $.datepicker.formatDate("yy-mm-dd", date_01);
		date_01_ok = date_01_ok + " 00:00:00";
		//@
		//@
		var date_02 = $( "#datepicker2" ).datepicker( "getDate" );
		var date_02_ok = $.datepicker.formatDate("yy-mm-dd", date_02);
		date_02_ok = date_02_ok + " 23:59:59";

		var datas = get_data_ajax();
		//console.log(datas);
		//return;
		
		ojs_thong_ke_admin.ajax_load(datas);	
	});			
	//		
	//	
	
	
	//
	//@
	//search theo ngày giờ set class
	$(document).on('click','.report_link_box li a',function(e) {	
		//@
		e.preventDefault();	
		$(this).parents('.report_link_box').find("a").removeClass("report_active");
		$(this).addClass("report_active");
		$('#btn_date').removeClass("report_active");


		$( "#datepicker" ).val("");
		$( "#datepicker2" ).val("");

		var datas = get_data_ajax();
		//console.log(datas);
		//return;
		
		ojs_thong_ke_admin.ajax_load(datas);	
				
	});			
	






	//@
	//@
	//@
	//@
	//@ thanh toan cong no
	$(document).on('click','.thanh-toan',function(e) {	
		e.preventDefault();	


		let order_id = $(this).find('a').attr("data_id");
		var datas = {
			"payment_period_payment" : 100000,
			"payment_period_order_id" : order_id
		}			
		//alert(order_id);
		//return;
		
		
		//
		//@
		let x = "xác nhận thanh toán công nợ";		
		let y = "thanh_toan_cong_no_order";
		let z = ' { "datas":' + JSON.stringify(datas) + ' }';
		ojs_message.message_yes_no_show(x,y,z);		
	});		




	//@
	//@
	//@ lọc
	$("#loc_by_store,#loc_order_status,#loc_cong_no").change(function() {	
		var datas = get_data_ajax();
		//console.log(datas);
		//return;
		
		ojs_thong_ke_admin.ajax_load(datas);	
	});			
	//		
	//	



	//@
	//@
	//@
	//@ get_data_ajax	
	//@ get_data_ajax	
	function get_data_ajax(){
	
		//@
		//@
		//@ lấy ngày thang
		var x = $(".report_link_box").find("li a.report_active");
		
		
		var date_send = "";
		var date_star = "";
		var date_end = "";
		if(x.length > 0){
			date_send = $(x).attr("data_send");
			date_star = ojs_share_date.get_date_star(date_send);
			date_end = ojs_share_date.get_date_end(date_send);			
		}else{
			var date_01 = $( "#datepicker" ).datepicker( "getDate" );
			var date_02 = $( "#datepicker2" ).datepicker( "getDate" );	
			
			if(date_01 == null || date_02 == null){
				ojs_message.message_ok_show("vui lòng chọn ngày");
				return;
			}
			var date_01 = $( "#datepicker" ).datepicker( "getDate" );
			var date_01_ok = $.datepicker.formatDate("yy-mm-dd", date_01);
			date_01_ok = date_01_ok + " 00:00:00";
			//@
			//@
			var date_02 = $( "#datepicker2" ).datepicker( "getDate" );
			var date_02_ok = $.datepicker.formatDate("yy-mm-dd", date_02);
			date_02_ok = date_02_ok + " 23:59:59";	

			date_star = date_01_ok;
			date_end = date_02_ok;
			
		}

		
		//@
		//@
		//@ data
		var loc_by_store = $('#loc_by_store').val();
		var loc_order_status = $('#loc_order_status').val();
		var loc_cong_no = $('#loc_cong_no').val();	



		limit = 2000;
		offset = 0;
		sort_field = "";
		sort_type = "";	
		
		var datas = {
			loc_by_store : loc_by_store,
			loc_order_status:loc_order_status,
			loc_cong_no:loc_cong_no,
			date_star : date_star,
			date_end : date_end,
			limit : limit,
			offset : offset,
			sort_field : sort_field,
			sort_type : sort_type
		}
		return datas;
	}	








	
	/////////////////////////////////////////////////		
	});
</script>	







<%- include ("../masterpage/loader-end") %>




















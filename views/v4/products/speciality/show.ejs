<% if( typeof title == 'string' && title){ title = title } else{ title="" } %>
<% include ../../masterpage/loader %>

<script src="../../../../<%= js_css_version %>/javascripts/class-product-speciality.js"></script>	



<% 
if(users_type == "admin"){
	var status_disebale = "";
}else{
	var status_disebale = "disabled";
}
%>


<% menu_taget = "sidebar_san_pham" %>


<div id="page_wrap" class="page_wrap">
<div id="layout" class="page_width layout">
<div id="content-wrap" class="content_wrap">
<!-- --------------------
page wrap 
--------------------- -->
<% include ../../masterpage/header %>


<!-- --------------------
content
--------------------- -->
<div id="content" class="content">
	<h1><a href="/stores/manage/<%= store_id %>/<%= user_id %>"><%= store_name %></a><i class="fas fa-chevron-right"></i>
	<a href="/products/<%= service_type_name %>/<%= store_id %>">Sản phẩm</a><i class="fas fa-chevron-right"></i>Chi tiết sản phẩm</h1>
	
	
	<div class="pro_content_edit">
		<div class="pro_col01">
			<div class="pro_box ten_sp_box">
				<h3>Tên Sản phẩm</h3>
				<div class="inside">
					<input type="text" value="<%-  ojs_share.unCape(datas[0].products_speciality_name) %>" id="products_speciality_name"/>
				</div>
			</div>
			
			<div class="pro_box thuoc_tinh_box">
				<h3>Thuộc tính</h3>
				<div class="inside">
					<p><span>Mã sku</span>
						<input type="text" disabled value="<%-  ojs_share.unCape( datas[0].products_speciality_sku ) %>" id="products_speciality_sku" /> </p>	
					<p><span>Tồn kho</span>
						<input  
						class="number_change" 
						data_value="<%= datas[0].products_speciality_stock %>"  
						type="text" 
						value="<%= datas[0].products_speciality_stock %>" 
						id="products_speciality_stock" 
						/> 
					</p>
					<p><span>Cân nặng(g)</span>
						<input 
						class="number_change" 
						data_value="<%= datas[0].products_speciality_weight %>" 						
						type="text" 
						value="<%= datas[0].products_speciality_weight %>" 
						id="products_speciality_weight" 
						/> 
					</p>
					<p><span>Chiều dài(cm)</span>
						<input 
						class="number_change" 
						data_value="<%= datas[0].products_speciality_length %>" 							
						type="text" 
						value="<%= datas[0].products_speciality_length %>" 
						id="products_speciality_length" 
						/> 
					</p>
					<p><span>Chiều rộng(cm)</span>
						<input 
						class="number_change" 
						data_value="<%= datas[0].products_speciality_width %>" 							
						type="text" 
						value="<%= datas[0].products_speciality_width %>" 
						id="products_speciality_width" 
						/> 
					</p>
					<p><span>Chiều cao(cm)</span>
						<input 
						class="number_change" 
						data_value="<%= datas[0].products_speciality_height %>" 							
						type="text" 
						value="<%= datas[0].products_speciality_height %>" 
						id="products_speciality_height" 
						/> 
					</p>	
					<p  style="display:none"><span>Loại sản phẩm</span><span class="giai-thich"><span>Normal:Bình thường, Variation: Biến thể(đang phát triển)</span></span>	
						<select id="products_speciality_type">
							<%- ojs_share.show_product_type(datas[0].products_speciality_type) %>
						</select>	
					</p>
				</div>
			</div>
			
			<div class="pro_box gia_box">
				<h3>Giá sản phẩm</h3>
				<div class="inside">
					<p><span>Giá bán</span>
						<input 
						class="number_change" 
						data_value="<%= datas[0].products_speciality_price %>" 
						type="text" 
						value="<%= datas[0].products_speciality_price %>" 
						id="products_speciality_price" /> 
					</p>
					<p><span>Giá khuyến mãi</span><span class="giai-thich"><span>Để trống nếu không KM</span></span>
						<input 
						class="number_change_empty" 
						data_value="<%= datas[0].products_speciality_sale_of_price %>" 						
						type="text" 
						value="<%= datas[0].products_speciality_sale_of_price %>" 
						id="products_speciality_sale_of_price" 
						/> 
					</p>
					<p><span>Ngày bắt đầu KM</span><span class="giai-thich"><span>Năm/tháng/ngày(VD:2021/01/01) để trống nếu không KM</span></span><input type="text" value="<%= datas[0].products_speciality_date_start %>" id="products_speciality_date_start" /> </p>	
					<p><span>Ngày kết thúc KM</span><span class="giai-thich"><span>Năm/tháng/ngày(VD:2021/01/01) để trống nếu không KM</span></span><input type="text" value="<%= datas[0].products_speciality_date_end %>" id="products_speciality_date_end" /> </p>
				</div>
			</div>	
	
			<div class="pro_box quy_cach_box" style="display:none">
				<h3>Quy cách</h3>
				<div class="inside">
					
					<p><span>Option variation</span><input type="text" value="<%-  ojs_share.unCape( datas[0].products_speciality_variation_option ) %>" id="products_speciality_variation_option" /> </p>
				</div>
			</div>
			
			<!-- ------------------
			//Mô tả ngắn
			------------------- -->
			<div class="pro_box" style="display:none">
				<h3>Mô tả ngắn (excerpt)</h3>
				<div class="inside">
					<textarea class="noi_dung"  id="excerpt"  rows="10" cols="100%"><%-  ojs_share.unCape( datas[0].products_speciality_excerpt ) %></textarea>
				</div>
			</div>
			<!-- ------------------
			//Thông tin chi tiết
			------------------- -->
			<div class="pro_box">
				<h3>Mô tả sản phẩm</h3>
				<div class="inside">
					<textarea class="noi_dung"  id="noi_dung"  rows="20" cols="100%"><%= ojs_share.unCape( datas[0].products_speciality_contents ) %></textarea>
				</div>
			</div>
			
			<div class="pro_box">
				<h3>Lời nhắn từ admin</h3>	
				<div class="inside">
					<textarea id="products_speciality_qoute"  rows="10" cols="100%" ><%-  ojs_share.unCape( datas[0].products_speciality_qoute ) %></textarea>
				</div>	
			</div>
		</div>	
	
	






		<div class="pro_col02">
			<!-- ------------------
			//category
			------------------- -->	
			<div class="pro_box">
				<h3>Danh mục sản phẩm</h3>	
				<div class="category_wrap inside">
					<div id="category_inner">
						<% include ../../masterpage/widget-category-product %>
					</div>	
				</div>
			</div>
			<!-- ------------------
			//end of category
			------------------- -->	
			
			<!-- ------------------
			//option
			------------------- -->	
			<div class="pro_box">
				<h3>Tùy chọn sản phẩm</h3>	
				<div class="option_wrap inside">
					<div id="option_inner">
						<% include ../../masterpage/widget-option-product %>
					</div>	
				</div>	
			</div>
			<!-- ------------------
			//end of option
			------------------- -->	
			
			<div class="pro_box thuong_hieu_box">
				<h3>Thương hiệu</h3>	
				<div class="inside">
					<select id="products_speciality_brand">
						<% include ../../masterpage/widget-brand-select-box %>
					</select>	
				</div>
			</div>






			<!-- ------------------
			//hình đại diện 
			------------------- -->
			<div class="pro_box">
				<h3>Ảnh đại diện</h3>	
				<div class="inside">
					<input type="text" 
						value="" 
						id="featured_image" 
						data_value="<%-  ojs_share.unCape( datas[0].products_speciality_featured_image ) %>" 
						style="display:none;" 
					/>
					<input type="button" value="Thêm ảnh" id="btn_featured_image">
					<div id="img_box_dai_dien"></div>
					<input type='file' accept="image/*" id='upload_image' style="display:none;">
				</div>
			</div>
			<!-- ------------------
			//end of hình đại diện 
			------------------- -->
			
			<!-- ------------------
			//hình slider 
			------------------- -->
			<div class="pro_box">
				<h3>Bộ sưu tập (giới hạn 6 ảnh)</h3>	
				<div class="inside">
					
					<input type="text" 
						value="" 
						data_value="<%-  ojs_share.unCape( datas[0].products_speciality_image_slider ) %>" 
						id="slider_image"  
						style="display:none;" 
					/> 					
		
					<input type='file' accept="image/*" id='upload_image_arr' style="display:none;" multiple>
					<input type="button" value="Thêm ảnh" id="btn_slider_image">
					<div id="arrImgBox"></div>
				</div>
			</div>


			<!-- ------------------
			//end of hình slider 
			------------------- -->





			<!--
			<div class="pro_box chiet_khau_box">
				<h3>Chiết khấu</h3>	
				<div class="inside">
					<input 
					class="number_change" 
					data_value="<%= datas[0].products_speciality_discount %>" 					
					type="text" 
					value="<%= datas[0].products_speciality_discount %>" 
					id="products_speciality_discount" 
					/>	
					<select id="products_speciality_unit_discount">
						<%- ojs_share.show_unit_discount(datas[0].products_speciality_unit_discount) %>
					</select>
				</div>
			</div>
			-->
			
			<div class="pro_box trang_thai_box">
				<h3>Trạng thái admin</h3>	
				<div class="inside">
					<!--<span>Cửa hàng:</span><span class="giai-thich"><span>Khi thông tin sản phẩm đã sẵn sàng, chọn "đã phê duyệt" để hiển thị sản phẩm.</span></span>
					<select id="products_speciality_status_store">
						<%- ojs_share.show_status_select_share_all_two(datas[0].products_speciality_status_store) %>
					</select>	-->
					<select id="products_speciality_status_admin"  <%- status_disebale %> >
						<%- ojs_share.show_status_select_share_all(datas[0].products_speciality_status_admin) %>
					</select>
				</div>
			</div>

			
		</div>
	</div>

	
	
	
	
<div class="btn_box">
	<a href="/products/speciality/<%= store_id %>/" class="btn_back">Quay về</a>
	<a href="#" class="btn_back">Lưu & Ẩn</a>
	<button id="btn_save" class="btn_save">Lưu</button>
</div>	
	
	
	
<input type="hidden" id="store_id" value="<%= datas[0].products_speciality_store_id %>"/>
<input type="hidden" id="products_speciality_status_update" value="<%= datas[0].products_speciality_status_update %>"/>

<input type="hidden" id="user_id" value="<%= user_id %>"/>
<input type="hidden" id="product_id" value="<%= product_id %>"/>




</div>

<!-- --------------------
end content
--------------------- -->





<% include ../../masterpage/footer %>

</div><!-- //content_wrap -->	


<% include ../../masterpage/sidebar %>

<!-- --------------------
//end of page wrap 
--------------------- -->
</div><!-- //layout -->	
</div><!-- //pagewrap -->



<script>
$(document).ready(function($){
/////////////////////////////////////////////////////	


	let date_s1 = $('#products_speciality_date_start').val();
	let date_s2 = $('#products_speciality_date_end').val();
		
	if(date_s1.length > 0){
		$( "#products_speciality_date_start" ).datepicker({
				dateFormat: "yy-mm-dd",
				timeFormat:  "hh:mm:ss",
				language: 'vi'
			}
		).datepicker ('setDate',  new Date (date_s1));
	}else{
		$( "#products_speciality_date_start" ).datepicker({
				dateFormat: "yy-mm-dd",
				timeFormat:  "hh:mm:ss",
				language: 'vi'
			}
		)		
	}
	
	if(date_s2.length > 0){	
		$( "#products_speciality_date_end" ).datepicker({
				dateFormat: "yy-mm-dd",
				timeFormat:  "hh:mm:ss",
				language: 'vi'
			}
		).datepicker ('setDate',  new Date (date_s2));
	}else{
		$( "#products_speciality_date_end" ).datepicker({
				dateFormat: "yy-mm-dd",
				timeFormat:  "hh:mm:ss",
				language: 'vi'
			}
		)		
	}


	//
	//@
	ojs_loader.loadTinyMCE('noi_dung');
	//
	//@
	ojs_loader.loadTinyMCE('excerpt');
	
		
	
	
	
	//@
	ojs_loader.show_anh_dai_dien('featured_image','img_box_dai_dien',"","");
	//@
	ojs_loader.show_anh_slider('slider_image','arrImgBox',"","");
	//@
	
	
	
	$(document).on('click','#btn_featured_image',function(e) {		
		e.preventDefault();		
		$('#upload_image').trigger( "click" );
	});
	//@
	$("#upload_image").on("change",function(){
		let input = this;
		ojs_loader.upload_anh_dai_dien(input,"featured_image","img_box_dai_dien")
	});		
	//
	//xua image dai dien
	$(document).on('click','.xoaAnhDaiDien',function(e) {		
		e.preventDefault();		
		
		// xoa image s3
		let products_speciality_featured_image = $('#featured_image').attr("data_value");
		let url = products_speciality_featured_image;
		ojs_loader.delete_s3(url);

		//xoa html
		$(this).parent(".img_box").remove();
		ojs_loader.set_value_anh_dai_dien('featured_image','img_box_dai_dien');
	});			
	//		
	//	
	//		
	//
	//xoa image slider
	$(document).on('click','.xoaAnhSlider',function(e) {		
		e.preventDefault();		
		$(this).parent(".img-box").remove();
		ojs_loader.set_value_anh_slider('slider_image','arrImgBox');
		ojs_loader.set_value_anh_slider_s3('slider_image_h','arrImgBox');
	});			
	//
	//	
	//
	//btn anh slider click
	$(document).on('click','#btn_slider_image',function(e) {		
		e.preventDefault();		
		$('#upload_image_arr').trigger( "click" );
	});		
	//
	//
	//upload anh slider
	$("#upload_image_arr").on("change",function(){
		let input = this;
		//alert('change');
		ojs_loader.upload_anh_slider(input,"slider_image","arrImgBox");
	});			
	//		
	//	
	
	
	
	
	// ajax luu san pham
	$(document).on('keyup','#products_speciality_date_start',function(e) {		
		e.preventDefault();
		var products_speciality_sale_of_price = $('#products_speciality_sale_of_price').val();
		if(products_speciality_sale_of_price.length <=0 ){
			ojs_message.message_ok_show("Vui lòng nhập gía khuyến mãi");
			$(this).val('');
		}
	});//end of save ajax

	// ajax luu san pham
	$(document).on('keyup','#products_speciality_sale_of_price',function(e) {		
		e.preventDefault();
		var products_speciality_sale_of_price = $('#products_speciality_sale_of_price').val();
		if(products_speciality_sale_of_price.length <=0 ){
			$('#products_speciality_date_end').val('');
			$('#products_speciality_date_start').val('');
		}
	});//en


	// ajax luu san pham
	$(document).on('keyup','#products_speciality_date_end',function(e) {		
		e.preventDefault();
		var products_speciality_sale_of_price = $('#products_speciality_sale_of_price').val();
		if(products_speciality_sale_of_price.length <=0 ){
			ojs_message.message_ok_show("Vui lòng nhập gía khuyến mãi");
			$(this).val('');
		}
	});//end of save ajax
			
	
	
	
	// ajax luu san pham
	$(document).on('change','#products_speciality_date_start',function(e) {		
		e.preventDefault();
		var products_speciality_sale_of_price = $('#products_speciality_sale_of_price').val();
		if(products_speciality_sale_of_price.length <=0 ){
			ojs_message.message_ok_show("Vui lòng nhập gía khuyến mãi");
			$(this).val('');
		}
	});//end of save ajax


	// ajax luu san pham
	$(document).on('change','#products_speciality_date_end',function(e) {		
		e.preventDefault();
		var products_speciality_sale_of_price = $('#products_speciality_sale_of_price').val();
		if(products_speciality_sale_of_price.length <=0 ){
			ojs_message.message_ok_show("Vui lòng nhập gía khuyến mãi");
			$(this).val('');
		}
	});//end of save ajax
			
	
		
	
	
	
	
	// ajax luu san pham
	$(document).on('click','#btn_save',function(e) {		
		e.preventDefault();
		
		//@
		let cat_arr = [];
		let ojs_cat = $('#category_inner').find('.cat_check');
		
		for(let i = 0; i < ojs_cat.length ; i ++ ){
			if(    $(ojs_cat[i]).prop("checked")    ){
				let x = $(ojs_cat[i]).val();
				cat_arr.push(x);
			}
		}
		//cat_arr = [1,2,"a",4];
		let cat_string = cat_arr;
		//console.log(cat_string);		
		//return;			
		
		
		//@
		//@
		//danh sach option
		let option_arr = [];
		let ojs_option = $('#option_inner').find('.option_check');
		
		for(let i = 0; i < ojs_option.length ; i ++ ){
			if(    $(ojs_option[i]).prop("checked")    ){
				let x = $(ojs_option[i]).val();
				option_arr.push(x);
			}
		}
		//@
		let option_string = option_arr;		
		//console.log(option_string);
		//return;
		
		
		//@
		let products_speciality_name = $('#products_speciality_name').val();
		let products_speciality_type = $('#products_speciality_type  option:selected').val();
		let products_speciality_sku = $('#products_speciality_sku').val();
		let products_speciality_store_id = $('#store_id').val();		
		
		let product_id = $('#product_id').val();
		let user_id = $('#user_id').val();
		
		
		
		let products_speciality_featured_image = $('#featured_image').attr("data_value");
		let products_speciality_image_slider = $('#slider_image').attr("data_value");			
		
		let products_speciality_contents = tinymce.get("noi_dung").getContent()
		let products_speciality_excerpt = tinymce.get("excerpt").getContent()
		
		let products_speciality_price = $('#products_speciality_price').attr("data_value")
		let products_speciality_sale_of_price = $('#products_speciality_sale_of_price').attr("data_value")
		
		
		let date_01 = $('#products_speciality_date_start').datepicker( "getDate" );
		let products_speciality_date_start = $.datepicker.formatDate("yy-mm-dd", date_01);
		
		//console.log(date_01);
		
		
		
		
		let date_02 = $('#products_speciality_date_end').datepicker( "getDate" );
		let products_speciality_date_end = $.datepicker.formatDate("yy-mm-dd", date_02);
		if(products_speciality_date_end.length > 0){
			products_speciality_date_end = products_speciality_date_end + " 23:59:59"
		}
		
		let products_speciality_stock = $('#products_speciality_stock').val() ;
		
		let products_speciality_brand = $('#products_speciality_brand  option:selected').val();		
		let products_speciality_status_admin = $('#products_speciality_status_admin  option:selected').val();
		let products_speciality_status_store = $('#products_speciality_status_store  option:selected').val();
			
		let products_speciality_variation_option = $('#products_speciality_variation_option').val() ;
		
		
		let products_speciality_height = $('#products_speciality_height').attr("data_value");
		let products_speciality_width = $('#products_speciality_width').attr("data_value");
		let products_speciality_length = $('#products_speciality_length').attr("data_value");
		let products_speciality_weight = $('#products_speciality_weight').attr("data_value");
		let products_speciality_status_update = $('#products_speciality_status_update').val();
		
		let products_speciality_discount = $('#products_speciality_discount').attr("data_value");
		
		
		let products_speciality_unit_discount = $('#products_speciality_unit_discount  option:selected').val();
		
		
		let products_speciality_qoute = $('#products_speciality_qoute').val();
		
		
		
		
		//@@
		if(products_speciality_stock == ""){products_speciality_stock = null;	};
		if(products_speciality_height == ""){products_speciality_height = null;};
		if(products_speciality_width == ""){products_speciality_width = null;};
		if(products_speciality_length == ""){products_speciality_length = null;};
		if(products_speciality_weight == ""){products_speciality_weight = null;};
		
		if(products_speciality_brand == ""){products_speciality_brand = null;};
		
		if(products_speciality_sale_of_price == ""){products_speciality_sale_of_price = null;};
		if(products_speciality_date_start == ""){products_speciality_date_start = null;};
		if(products_speciality_date_end == ""){products_speciality_date_end = null;};
		
		//@@
		//@@
		let datas = {
			"option_string" : option_string,
			"cat_string" : cat_string,
			"datas":{
				products_speciality_name : products_speciality_name,
				products_speciality_type :  products_speciality_type,
				products_speciality_sku : products_speciality_sku,
				products_speciality_store_id : products_speciality_store_id,
				products_speciality_featured_image : products_speciality_featured_image,
				products_speciality_image_slider : products_speciality_image_slider,
				products_speciality_contents : products_speciality_contents,
				products_speciality_excerpt : products_speciality_excerpt,
				products_speciality_price : products_speciality_price,
				products_speciality_sale_of_price : products_speciality_sale_of_price,
				products_speciality_date_start : products_speciality_date_start,
				products_speciality_date_end : products_speciality_date_end,
				products_speciality_stock : products_speciality_stock,
				products_speciality_brand : products_speciality_brand,
				products_speciality_status_admin : products_speciality_status_admin,
				products_speciality_status_store : products_speciality_status_store,
				products_speciality_variation_option : products_speciality_variation_option,
				products_speciality_height : products_speciality_height,
				products_speciality_width : products_speciality_width,
				products_speciality_length : products_speciality_length,
				products_speciality_weight : products_speciality_weight,
				products_speciality_discount : products_speciality_discount,	
				products_speciality_unit_discount : products_speciality_unit_discount,
				products_speciality_status_update : products_speciality_status_update,
				products_speciality_qoute :products_speciality_qoute
			}
		}
	//console.log(datas);		
	//return;
	
	ojs_products_speciality.ajax_update(datas,product_id);	
		
	});//end of save ajax
	//
	//
///////////////////////////////////////////////////////
});//end of document
</script>












<% include ../../masterpage/loader-end %>	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
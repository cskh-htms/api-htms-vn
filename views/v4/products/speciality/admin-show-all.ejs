<% include ../../masterpage/loader %>
<link rel='stylesheet' href='/<%= js_css_version %>/stylesheets/share-menu-admin.css' />
<link rel='stylesheet' href='/<%= js_css_version %>/stylesheets/product.css' />
<link rel='stylesheet' href='/<%= js_css_version %>/stylesheets/product-show-all.css' />
<link rel='stylesheet' href='/<%= js_css_version %>/stylesheets/share-page-nav.css' />

<script src="../../../../<%= js_css_version %>/javascripts/class-product-speciality-admin.js"></script>	





<div id="page_wrap" class="page_wrap">
<div id="layout" class="page_width layout">
<div id="content-wrap" class="content_wrap">
<!-- --------------------
page wrap 
--------------------- -->



<% include ../../masterpage/header %>
<% include ../../masterpage/function-share-all %>
<% include ../../masterpage/function-share-product %>



<script>
	console.log(<%- JSON.stringify({"datas_info" : datas_info}) %>);
</script>	


<!-- --------------------
content
--------------------- -->
<div id="content" class="content">

	<h1><a href="/admin/">Admin</a><i class="fas fa-chevron-right"></i>Danh sách sản phẩm</h1>



	<div class="sap_xep_loc">
		<div class="sap_xep_wrap">

			<select id="sap_xep_sp">
				<option value="moinhat">Sản phẩm mới nhất</option>
				<option value="giacao">Giá cao > thấp</option>
				<option value="giathap">Giá thấp < cao</option>
			</select>
		</div>
		
	

		<div class="loc_type">
			<select id="loc_type">
				<option value="[0,1,2,3,4]">Các loại sản phẩm -> tất cả</option>
				<option value="[0]">Sản phẩm thường</option>
				<option value="[1]">Sản phẩm biến thể</option>
				<option value="[2]">Sản phẩm quà tặng</option>
			</select>
		</div>
			
		
		<div class="loc_khuyen_mai">
			<select id="loc_khuyen_mai">
				<option value="all">Chương trình khuyến mãi -> tất cả</option>
				
				<% 
				if( discount_list.length > 0){
				for(x in discount_list){
				%>	
					<option value="<%= discount_list[x].discount_program_ID %>">
						<%= discount_list[x].discount_program_name %>
						( <%= discount_list[x].count_discount_program_ID %> )
					</option>
				<%
				}
				}
				%>
				
			</select>
		</div>		
		
		
		
		<div class="loc_cua_hang">
			<select id="loc_cua_hang">
				<option value="all">Cửa hàng -> tất cả</option>
				
				<% 
				if( store_fillter.length > 0){
				for(x in store_fillter){
				%>	
					<option value="<%= store_fillter[x].stores_ID %>">
						<%= store_fillter[x].stores_name  %>
						( <%= store_fillter[x].count_stores_name %> )
					</option>
				<%
				}
				}
				%>
				
			</select>
		</div>			
		
		
		
		
		
		
		<div class="loc_wrap">
			<select id="loc_km">
				<option value="[0,1,2,3,4]">Sản phẩm khuyến mãi -> tất cả </option>
				<option value="[1,4]">Đang khuyến mãi</option>
				<option value="[3]">Khuyến mãi đã quá hạn</option>
				<option value="[0]">Không có khuyến mãi</option>
			</select>



			
			
			<select id="loc_stock">
				<option value="tat_ca">Tồn kho -> tất cả</option>
				<option value="het_hang">Hết hàng</option>
				<option value="sap_het_hang">Sắp hết hàng</option>
			</select>				
			
			
			
			<select id="loc_danh_muc" >
				<option value="all">Tất cả danh mục</option>
				<% 
				for(x in category_by_store){
				%>	
					<option value="<%= category_by_store[x].category_general_speciality_ID %>">
						<%= category_by_store[x].category_general_speciality_name %>
						( <%= category_by_store[x].count_category_general_speciality_name %> )
					</option>
				<%
				}
				%>
			</select>
			<select id="loc_trang_thai">
				<option id="all" value="[1,2,3,4]" selected>Tất cả trạng thái</option>
				<option id="checking" value="[4]">Chờ duyệt</option>
				<option id="edit" value="[2]">Đã sửa chờ duyệt</option>
				<option id="refuse" value="[3]">Bị từ chối</option>
				<option id="checked" value="[1]">Đã duyệt</option>
			</select>
		</div>
	</div>	
	
	
	<div class="sap_xep_loc">
		<div class="sap_xep_wrap"  style="padding-left: 14px;">
			<input type="text" id="text-search" value="" placeholder="Tìm tên sản phẩm">
			<button id="btn-text-search"> Tìm </button>
		</div>	
	</div>	
	
	
	<div style="" id="fillter-wrap">
		<div style="" id="fillter-inner">
			<div class="loc-theo-theo-gia"></div>
			<div class="loc-theo-khuyen mai"></div>
			<div class="loc-theo-ton-kho"></div>
			<div class="loc-theo-danh-muc"></div>
			<div class="loc-theo-trang-thai"></div>
		</div>
	</div>	


	<div id="ajax-wrap">
	
	<% include ../../masterpage/widget-product-speciality-show-tables-v5-admin %>
	
	</div>		














	
<input type="hidden" id="user_id" value="<%= user_id %>"/>

</div>
<!----------------------
end content
----------------------->












<% include ../../masterpage/footer %>

</div><!-- //content_wrap -->	


<% include ../../masterpage/sidebar %>

<!----------------------
//end of page wrap 
----------------------->
</div><!-- //layout -->	
</div><!-- //pagewrap -->

<script>
$(document).ready(function($){
/////////////////////////////////////////////////////	
	
	
	
	//@
	//@
	//@
	//@
	add_data_fillter();
	
	
	
	
	
	
	//@
	//@
	//@
	//@Loc danh muc
	///////////////////////////	
	$("#loc_danh_muc,#loc_km,#loc_stock,#sap_xep_sp,#loc_trang_thai,#loc_type,#loc_khuyen_mai,#loc_cua_hang").change(function() {
		var datas = get_data_ajax();
		add_data_fillter();
		//console.log(datas);
		//return;
		ojs_products_speciality_admin.ajax_load_products_admin(datas);	
	});	
	
	
	
	
	
	//tim theo ten
	///////////////////////////	
	$(document).on('click','#btn-text-search',function(e) {

		let user_id = $('#user_id').val();
		var x  = $('#text-search').val();		

		if(x.length < 3 ){
			ojs_message.message_ok_show("Vui lòng nhập từ 3 ký tự trổ lên");
			return;
		}
		
		var datas = {
			"user_id" : user_id,
			"status_data" : JSON.parse("[1,2,4]"),
			"category_data" :"all",
			"discount_data" :JSON.parse("[0,1,2,3,4]"),
			"sort_data" :'moinhat',	
			"stock_data" :"tat_ca",	
			"data_limit" :200,	
			"data_offset" :0,	
			"loc_type_data" :JSON.parse("[0,1,2,3,4]"),
			"loc_khuyen_mai_data" : "all",
			"text_search_data" : x,
			"loc_cua_hang_data" : 'all',	
		}		
		
	
		//console.log(datas);
		//return;
		ojs_products_speciality_admin.ajax_load_products_admin(datas);		
	});	
	
	
	$( "#text-search" ).keypress(function( event ) {
	  if ( event.which == 13 ) {
		 event.preventDefault();
		let user_id = $('#user_id').val();
		let store_id = $('#store_id').val();		
		var x  = $('#text-search').val();		

		if(x.length < 3 ){
			ojs_message.message_ok_show("Vui lòng nhập từ 3 ký tự trổ lên");
			return;
		}
		
		var datas = {
			"user_id" : user_id,
			"status_data" : JSON.parse("[1,2,4]"),
			"category_data" :"all",
			"discount_data" :JSON.parse("[0,1,2,3,4]"),
			"sort_data" :'moinhat',	
			"stock_data" :"tat_ca",	
			"data_limit" :200,	
			"data_offset" :0,	
			"loc_type_data" :JSON.parse("[0,1,2,3,4]"),
			"loc_khuyen_mai_data" : "all",
			"text_search_data" : x,
			"loc_cua_hang_data" : 'all'
		}	
		ojs_products_speciality_admin.ajax_load_products_admin(datas);			
	  }
	});	
		
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	//@
	//@
	//@
	//@ refresh fillter
	$(document).on('click','.reset-btn',function(e) {	
		//@
		e.preventDefault();	
		location.reload();
	});		
		
	
	
	
	
	//@
	//@
	//@
	//xem
	$(document).on('click','.page-nav-inner a',function(e) {	
		//@
		e.preventDefault();	
		$(".page-nav-inner a").removeClass("active");
		var pav_taget = parseInt($(this).html());
		$('.page-nav-inner a:nth-child(' + pav_taget + ')').addClass("active");
		e.preventDefault();	
		
		var datas = get_data_ajax();
		//console.log(datas);
		//return;
		ojs_products_speciality_admin.ajax_load_products_table_admin(datas);
		
	});		
	//
	//@		
	
	
	
		
	
	
	
	//@
	//xoa
	$(document).on('click','.btn-delete',function(e) {	
		//@
		e.preventDefault();		
		let product_id = $(this).attr("data_product_id");

		//
		//@
		let x = "xác nhận xoá";		
		let y = "admin_delete_product_speciality";//function name in callback 
		let z = ' { "product_id" : "' + product_id + '" }';
		ojs_message.message_yes_no_show(x,y,z);	
	});			
	//		
	//	
	
	
	//
	//@
	//add class active
	$(document).on('click','.btn_add_store',function(e) {	
		e.preventDefault();
		$('.store_row').find('.btn_add_store').removeClass('active');
		$(this).addClass('active');
	});//end of function	
	//@
	//@	
	

	

	
	
	//
	//@
	//xem
	$(document).on('click','.btn-xem',function(e) {	
		//@
		e.preventDefault();		
		var product_id = $(this).attr("data_product_id");
		//alert(product_id);
		//return;
		ojs_products_speciality_admin.show_content_product(product_id);
		//@
	});		
	//
	//@	
	
	
	//
	//@
	//xem
	$(document).on('click','.btn-duyet',function(e) {	
		//@
		e.preventDefault();		
		var product_id = $(this).attr("data_product_id");
		//alert(product_id);
		//return;
		var datas = {
			"datas": {
				"products_speciality_status_admin":"1"
			}
		}

		ojs_products_speciality_admin.ajax_duyet(datas,product_id);
		//@
	});		
	//
	//@	
		
	
	//
	//@
	//duyệt
	$(document).on('click','.btn-tu-choi',function(e) {	
		//@
		e.preventDefault();	
		var product_id = $(this).attr("data_product_id");
		//alert(product_id);
		//return;		
		

		let html = "" + 
		'<div class="ajax-box">' + 
			'<div class="ajax-box-inner">' + 
				'<h1> lý do từ chối</h1>' + 
				'<textarea rows="10" cols="50" id="tu-choi-content"></textarea>' + 
				'<div class="btn-tu-choi-go" style="text-align:right">' + 
					'<span id="btn-tu-choi-go" data_product_no_id="' + product_id + '" class="btn-design">save</span>' + 
				'</div>' + 
			'</div>';	
		'</div>';
		
		
		ojs_loadding.ajax_show_content( html);
		//@
	});			
	
	
	
	//
	//@
	//duyệt
	$(document).on('click','#btn-tu-choi-go',function(e) {	
		//@
		e.preventDefault();		
		var product_id = $(this).attr("data_product_no_id");
		var content = $('#tu-choi-content').val();
		
		//alert(product_id);
		//return;		
		
		var datas = {
			"datas": {   
				"products_speciality_status_admin" :"3",
				"products_speciality_qoute":content
			}
		}
		
		
		//alert(content);
		//return;

		ojs_products_speciality_admin.ajax_tu_choi(datas,product_id);
		//@
	});		



	//@
	//@
	//@
	//@ get_data_ajax	
	function get_data_ajax(){
		let user_id = $('#user_id').val();
		let status_data = $('#loc_trang_thai').val();
		let category_data = $('#loc_danh_muc').val();
		let discount_data = $('#loc_km').val();
		let sort_data = $('#sap_xep_sp').val();
		let stock_data = $('#loc_stock').val();
		var data_limit = $('.page-nav-inner a.active').attr('data-limit') || 20;
		var data_offset = $('.page-nav-inner a.active').attr('data-offset') || 0;
		
		let loc_type_data = $('#loc_type').val();
		let loc_khuyen_mai_data = $('#loc_khuyen_mai').val();
		let loc_cua_hang_data = $('#loc_cua_hang').val();
		
		var datas = {
			"user_id" : user_id,
			"status_data" : JSON.parse(status_data),
			"category_data" :category_data,
			"discount_data" :JSON.parse(discount_data),
			"sort_data" :sort_data,	
			"stock_data" :stock_data,	
			"data_limit" :data_limit,	
			"data_offset" :data_offset,	
			"loc_type_data" :JSON.parse(loc_type_data),
			"loc_khuyen_mai_data" : loc_khuyen_mai_data,
			"loc_cua_hang_data" : loc_cua_hang_data,
		}
		return datas;
	}	
	
	
	//@
	//@
	//@
	//@ function add_data_fillter
	function add_data_fillter(){
		
		let sort_data = $('#sap_xep_sp').val();
		let sort_data_text = $( "#sap_xep_sp option:selected" ).text();
		
		let loc_type = $('#loc_type').val();
		let loc_type_text = $( "#loc_type option:selected" ).text();		
		
		let loc_khuyen_mai = $('#loc_khuyen_mai').val();
		let loc_khuyen_mai_text = $( "#loc_khuyen_mai option:selected" ).text();				
	
		let loc_cua_hang = $('#loc_cua_hang').val();
		let loc_cua_hang_text = $( "#loc_cua_hang option:selected" ).text();		
		
		let discount_data = $('#loc_km').val();		
		let discount_data_text = $( "#loc_km option:selected" ).text();	
		
		let stock_data = $('#loc_stock').val();		
		let stock_data_text = $( "#loc_stock option:selected" ).text();		
		
		let category_data = $('#loc_danh_muc').val();
		let category_data_text = $( "#loc_danh_muc option:selected" ).text();	
		
		let status_data = $('#loc_trang_thai').val();
		let status_data_text = $( "#loc_trang_thai option:selected" ).text();	
	

		var x = "";
		x = x + '<div class="filletr-btn" data_va="' + 'moinhat' + '" data_id="sap_xep_sp">' + sort_data_text + '<span class="f-x"> X </span></div>'; 
		x = x + '<div class="filletr-btn" data_va="' + 'loc_type' + '"  data_id="loc_type">' + loc_type_text + '<span class="f-x"> X </span></div>'; 
		x = x + '<div class="filletr-btn" data_va="' + 'loc_khuyen_mai' + '"  data_id="loc_khuyen_mai">' + loc_khuyen_mai_text + '<span class="f-x"> X </span></div>'; 
		x = x + '<div class="filletr-btn" data_va="' + 'loc_cua_hang' + '"  data_id="loc_cua_hang">' + loc_cua_hang_text + '<span class="f-x"> X </span></div>';		
			
		x = x + '<div class="filletr-btn" data_va="' + discount_data + '"  data_id="loc_km">' + discount_data_text + '<span class="f-x"> X </span></div>'; 
		x = x + '<div class="filletr-btn" data_va="' + stock_data + '"  data_id="loc_stock">' + stock_data_text + '<span class="f-x"> X </span></div>'; 
		x = x + '<div class="filletr-btn" data_va="' + category_data + '"  data_id="loc_danh_muc">' + category_data_text + '<span class="f-x"> X </span></div>'; 
		x = x + '<div class="filletr-btn" data_va="' + status_data + '"  data_id="loc_trang_thai">' + status_data_text + '<span class="f-x"> X </span></div>'; 		
		x = x + '<div  class="filletr-btn reset-btn">reset</div>'; 
		$('#fillter-inner').html(x);
	}	












	

///////////////////////////////////////////////////////
});//end of document
</script>




<% include ../../masterpage/loader-end %>	
	
	
	
	
	
	















<% if( typeof title == 'string' && title){ title = title } else{ title="" } %>
<% include ../../masterpage/loader %>



<script src="../../../../<%= js_css_version %>/javascripts/class-news-general.js"></script>	



<div id="page_wrap" class="page_wrap">
<div id="layout" class="page_width layout">
<div id="content-wrap" class="content_wrap">
<!-- --------------------
page wrap 
--------------------- -->
<% include ../../masterpage/header %>


<script>
	console.log(<%- JSON.stringify({"datas_info" : datas_info}) %>);
</script>	







<% //neu admin thi hien muc nay
var	enable_text = " disabled " ;
var	enable_text2 = " " ;
var	enable_text3 = " disabled " ;

if(user_role =="admin"){ 
	enable_text3 = "" ;
	enable_text2 = " disabled "
}

%>







<!-- --------------------
//content
--------------------- -->
<div id="content" class="content">

	<h1><a href="/admin/">Admin</a><i class="fas fa-chevron-right"></i>
	<a href="/news/general/">Tin tức</a><i class="fas fa-chevron-right"></i>Chỉnh sửa tin tức</h1>
	
	
	
	<div class="pro_content_edit">
		<div class="pro_col01">
		
		
			<div class="pro_box ten_sp_box">
				<h3>Tiêu đề</h3>
				<div class="inside">
					<input type="text" value="<%- ojs_share.unCape(datas[0].news_title) -%>" id="news_title"/>
				</div>
			</div>
			
			


			<!-- ------------------
			//Nội dung
			------------------- -->
			<div class="pro_box">
				<h3>Nội dung</h3>
				<div class="inside"><textarea class="noi_dung"  id="noi_dung"  rows="20" cols="100%"><%- ojs_share.unCape(datas[0].news_contents ) -%></textarea></div>
			</div>
			<!-- ------------------
			//Nội dung
			------------------- -->
		</div>
		<div class="pro_col02">
		
		
		
			<!-- ------------------
			//hình đại diện 
			------------------- -->
			<div class="pro_box">
				<h3>Ảnh đại diện 
				<a class="giai-thich" href="https://hotro.appdala.com/them-san-pham-tren-dala/#anh-dai-dien" target="_blank"><span>Chọn hình có tỉ lệ vuông</span>
				</a></h3>	
				<div class="inside">
					<input type="text" 
						value="" 
						id="featured_image" 
						data_value="<%-  ojs_share.unCape( datas[0].news_featured_image ) %>" 
						style="display:none;" 
					/>
					<input type="button" value="Thêm ảnh" id="btn_featured_image">
					<div id="img_box_dai_dien"></div>
					<input type='file' accept="image/*" id='upload_image' style="display:none;">
				</div>
			</div>
			<!-- ------------------
			//end of hình đại diện 
			------------------- -->
		
		
		
		
		

			<div class="pro_box trang_thai_box">
				<h3>Trạng thái</h3>	
				<div class="inside">
					<select id="news_status_admin">
						<%- ojs_share.show_status_product(datas[0].news_status_admin) %>
					</select>
				</div>
			</div>
		</div>
	</div>
	







<div class="btn_box">
	<a href="/news/general/" class="btn_back">Quay về</a>
	<%
	if( datas[0].news_status_admin == "0" ){
	%>	
		<a href="#" class="btn_back" id="btn_draf">Lưu & Ẩn</a>
	<%	
	}
	%>	
	<button id="btn_save" class="btn_save">Save</button>
</div>	
	
<input type="hidden" id="user_id" value="<%= user_id %>"/>
<input type="hidden" id="news_id" value="<%= news_id %>"/>

</div>

<!-- --------------------
end content
--------------------- -->








<% include ../../masterpage/footer %>

</div><!-- //content_wrap -->	


<% include ../../masterpage/sidebar %>

<!-- --------------------
//end of page wrap 
--------------------- -->
</div><!-- //layout -->	
</div><!-- //pagewrap -->



<script>
$(document).ready(function($){
/////////////////////////////////////////////////////	
	var news_id = $('#news_id').val();
	ojs_loader.show_anh_dai_dien('featured_image','img_box_dai_dien',"","");
	//@
	//@
	$(document).on('click','#btn_featured_image',function(e) {		
		e.preventDefault();		
		$('#upload_image').trigger( "click" );
	});
	//@
	$("#upload_image").on("change",function(){
		let input = this;
		ojs_loader.upload_anh_dai_dien(input,"featured_image","img_box_dai_dien",user_id)
	});		
	//
	//xua image dai dien
	$(document).on('click','.xoaAnhDaiDien',function(e) {		
		e.preventDefault();		
		
		// xoa image s3
		let products_speciality_featured_image = $('#featured_image').attr("data_value");
		let url = products_speciality_featured_image;
		ojs_loader.delete_wp(url);

		//xoa html
		$(this).parent(".img_box").remove();
		ojs_loader.set_value_anh_dai_dien('featured_image','img_box_dai_dien');
	});	
	
	
	//@
	$(document).on('click','#btn_draf',function(e) {		
		e.preventDefault();
		var datas = get_datas();	
		
		datas.datas.news_status_admin = 0;
		
		//console.log(datas);
		//return;
		


		ojs_news_general.ajax_update(datas,news_id);	
	});
	
	//@
	//@
	//@
	//@
	$(document).on('click','#btn_save',function(e) {		
		e.preventDefault();
		var datas = get_datas();	
		
		//console.log(datas);
		//return;
		
		ojs_news_general.ajax_update(datas,news_id);	
	});


	
	
	function get_datas(){
		
		let news_title = $('#news_title').val();
		let news_status_admin = $('#news_status_admin  option:selected').val();
		let news_contents = $('#noi_dung').val();
		let news_featured_image = $('#featured_image').attr('data_value');
		
		let datas = {
			"datas":{
				news_title : news_title,
				news_status_admin : news_status_admin,
				news_contents : news_contents,
				news_featured_image : news_featured_image
			}
		}
		
		
		//console.log(datas);		
		return datas;
	}
	//
	//
///////////////////////////////////////////////////////
});//end of document
</script>












<% include ../../masterpage/loader-end %>






	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
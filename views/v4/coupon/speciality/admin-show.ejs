

<%- include ("../../masterpage/loader") %>
<link rel='stylesheet' href='/<%= js_css_version %>/stylesheets/share-menu-admin.css' />
<link rel='stylesheet' href='/<%= js_css_version %>/stylesheets/coupon.css' />
<link rel='stylesheet' href='/<%= js_css_version %>/stylesheets/coupon-show.css' />




<script src="../../../../../<%= js_css_version %>/javascripts/ojs-share-upload.js"></script>		
<script src="../../../../../<%= js_css_version %>/javascripts/class-coupon-speciality-admin.js"></script>






<div id="page_wrap" class="page_wrap">
<div id="layout" class="page_width layout">
<div id="content-wrap" class="content_wrap">



<!-- --------------------
page wrap 
--------------------- -->



<%- include ("../../masterpage/header") %>
<%- include ("../../masterpage/function-share-coupon") %>
<%- include ("../../masterpage/function-share-all") %>
<%- include ("../../masterpage/function-share-all-admin") %>


<script>
	console.log(<%- JSON.stringify({"datas_info" : datas_info}) %>);
</script>


<!-- --------------------
content
--------------------- -->
<div id="content" class="content">
	<h1><a href="/admin/">home</a><i class="fas fa-chevron-right"></i>
	<a href="coupon/speciality/">coupons</a><i class="fas fa-chevron-right"></i>Chỉnh sữa coupon</h1>
	<div class="coupon_content pro_content_edit">
		<div class="pro_col01">
			<!-- Mã coupon -->
			<div class="pro_box">
				<h3>Mã coupon</h3>
				<div class="inside">
					<input type="text" 
					value="<%- ojs_share_all.unCape(datas[0].coupon_speciality_code) -%>" 
					id="coupon_speciality_code" />
				</div>
			</div>


			<div class="pro_box">
			<div class="thong_tin_coupon" >	
		
				<p style="display:none;"><span>Loại coupon<span>
					<select id="coupon_speciality_type">
						<%- ojs_share_coupon.show_coupon_type_select(datas[0].coupon_speciality_type) %>
					</select>	
				</p>		
					
		
				<p>
				<span>Điều kiện<span>
					<select id="coupon_speciality_condition">
						<%- ojs_share_coupon.show_coupon_condition_select( datas[0].coupon_speciality_condition ) %>
					</select>	
				</p>	


				<%
				if(
				datas[0].coupon_speciality_condition == "0" 
				|| 
				datas[0].coupon_speciality_condition == "3" 		
				){
					var condition_show = "display:none;"
				}else{
					var condition_show = "display:block;"
				}
				%>
				<p  id="gia_tri_dieu_kien_coupon" sadasd="sdadasd" style="<%- condition_show %>">
					<span>Giá trị điều kiện<span>
					<a href="https://sites.google.com/view/huong-dan-cua-hang-dala/tao-coupon/dieu-kien-dung-coupon"  
					target="_blank" class="giai_thich_link">
						<span class="giai-thich"><span>Nhập giá trị cho điều kiện ở trên</span></span></a>			
						<input 
							class="number_change" type="text" 
							data_value="<%= datas[0].coupon_speciality_condition_value %>"
							value="<%= ojs_share_all.show_price_format(datas[0].coupon_speciality_condition_value,0,",",".","") %>" 
							id="coupon_speciality_condition_value" 
						/>			
				</p>
			</div>
			</div>
			
			<div class="pro_box">
			<div class="cong_thuc_coupon-box">
				<div class="cong_thuc_coupon">
					<p>
					<span>Tên công thức<span>
						<select id="coupon_speciality_formula_price">
							<%- ojs_share_coupon.show_coupon_formula_select(datas[0].coupon_speciality_formula_price ) %>
						</select>	
					</p>
				
					<%
					if(
					datas[0].coupon_speciality_formula_price == "2" 		
					){
						var price_show = "display:none;"
					}else{
						var price_show = "display:block;"
					}
					%>
					
					<p id="gia_tri_cong_thuc_coupon" style="<%- price_show %>"><span>Tiền giảm giá </span>
						<input 
							class="number_change" type="text" 
							data_value="<%= datas[0].coupon_speciality_formula_price_value %>"
							value="<%= ojs_share_all.show_price_format(datas[0].coupon_speciality_formula_price_value,0,",",".","") %>" 
							id="coupon_speciality_formula_price_value" 
						/>
					</p>
				</div>


				<div class="cong_thuc_coupon">
					<p><span>Giảm giá tối đa</span>
						<input 
							class="number_change" type="text" 
							data_value="<%= datas[0].coupon_speciality_price_max %>"
							value="<%= ojs_share_all.show_price_format(datas[0].coupon_speciality_price_max,0,",",".","") %>" 
							id="coupon_speciality_price_max" 
						/>
					</p>
				</div>
			</div>
			</div>
	
	
	
	
	
	
			
			<!-- --------------------------
				//hoa hồng người giới thiệu
			--------------------------- -->	
			
			<div class="pro_box">
			<h3>Người giới thiệu</h3>
			<div class="noi_dung_coupon inside">
				<div class="thong_tin_coupon">	
					<span>Chọn người giới thiệu<span>
					<a href="#"  target="_blank"  class="giai_thich_link">
						<span class="giai-thich"><span>Chọn người hưởng ưu đãi khi giới thiệu coupon</span></span>	
						</a>
						<select id="coupon_speciality_intro">
							<option value="">Chọn người giới thiệu</option>
							<%
							for(x in user_list){
							%>	
								<%
								if(datas[0].coupon_speciality_intro == user_list[x].users_ID){
								%>	
									<option value="<%= user_list[x].users_ID %>" selected style="color:red;">
										<%- user_list[x].users_full_name %> (
										<%- user_list[x].users_phone %> )
									</option>		
								<%
								}else{
								%>	
									<option value="<%= user_list[x].users_ID %>">
										<%- user_list[x].users_full_name %> (
										<%- user_list[x].users_phone %> )
									</option>	

								<%
								}
								%>	
							<%
							}
							%>								
						</select>												
					</p>		
						

					<p>
						<span>Phần trăm chiếc khấu<span>
						<a class="giai-thich" href="#" target="_blank"><span>Phần trăm được hưởng trên mã coupon này</span></a>	
						<input 
						class="number_change" type="text" 
						data_value="<%= datas[0].coupon_speciality_intro_price %>"
						value="<%= ojs_share_all.show_price_format(datas[0].coupon_speciality_intro_price,0,",",".","") %>" 
						id="coupon_speciality_intro_price" 
					/>	
					</p>	


					<p>
						<span>Giới hạn tối đa<span>
						<a class="giai-thich" href="#" target="_blank"><span>Số tiền tối đa dược nhận</span></a>	
						<input 
						class="number_change" type="text" 
						data_value="<%= datas[0].coupon_speciality_intro_price_limit %>"
						value="<%= ojs_share_all.show_price_format(datas[0].coupon_speciality_intro_price_limit,0,",",".","") %>" 
						id="coupon_speciality_intro_price_limit" 
					/>	
					</p>	


					<p>
						<span>Website của người giới thiệu<span>
						<a class="giai-thich" href="#" target="_blank"><span>Website của người giới thiệu </span></a>	
						<input 
							type="text" 
							value="<%- datas[0].coupon_speciality_marketing_return %>" 
							id="coupon_speciality_marketing_return" 
							placeholder="Nhập địa chỉ website "
						/>
					</p>

					
				</div>
			</div>		
			</div>
			
			<!-- --------------------------
				//hoa hồng người giới thiệu
			--------------------------- -->			
	
	
	
	
	
	
	
	
	
	
	
	
	
			<p style="display:none;"><span>Tiền khuyến mãi<span>
				<select id="coupon_speciality_pay_type">
					<%- ojs_share_coupon.show_coupon_pay_type_select(datas[0].coupon_speciality_pay_type) %>
				</select>	
			</p>
	
	
			<!-- ------------------
			Mô tả coupon
			------------------- -->
			<div class="pro_box ">
				<h3>Mô tả coupon</h3>
				<div class="inside">
					<textarea 
					class="noi_dung"  
					id="noi_dung"  
					rows="20" 
					cols="100%"><%- ojs_share_all.unCape( datas[0].coupon_speciality_info ) -%></textarea>
				</div>
			</div>	


			<!-- Tin nhắn admin -->
			<div class="pro_box trang_thai_box ">
				<h3>Lời nhắn</h3>
				<div class="inside">
					<textarea class="quote" 
					id="coupon_speciality_qoute"  
					rows="10" cols="100%"><%- ojs_share_all.unCape(datas[0].coupon_speciality_qoute) -%></textarea>					
				</div>
			</div>
			
		</div>





		<div class="pro_col02">
		
			<!-- ------------------
			//hình đại diện 
			------------------- -->
			<div class="pro_box">
				<h3>Ảnh đại diện</h3>	
				<div class="inside">
					<input type="text" 
						value="" 
						id="featured_image" 
						data_value="<%-  ojs_share_all.unCape( datas[0].coupon_speciality_featured_image ) %>" 
						style="display:none;" 
					/>
					<input type="button" value="Thêm ảnh" id="btn_featured_image">
					<div id="img_box_dai_dien"></div>
					<input type='file' accept="image/*" id='upload_image' style="display:none;">
				</div>
			</div>
			<!-- ------------------
			//hình đại diện  
			------------------- -->	




			<!-- --------------
			//thời gian khuyến mãi
			---------------- -->			
			<div class="pro_box">
				<h3>Thời gian khuyến mãi <a href="#"  target="_blank" class="giai_thich_link">
				<span class="giai-thich"><span>Khuyến mãi không thời hạn hay có thời hạn</span></span>	
				</a></h3>
				<div class="inside">
					<select id="coupon_speciality_time_type">
						<%- ojs_share_coupon.show_coupon_time_type(datas[0].coupon_speciality_time_type) %>
					</select>	
				</div>									
			</div>		








			<!-- Thời gian -->
			<%
			var class_ashow_hide = 'style="display:none;"';
			if(datas[0].coupon_speciality_time_type == 1){
				class_ashow_hide = 'style="display:block;"';
			}			
			%>
			<div class="pro_box"  <%- class_ashow_hide -%> id="hieu-luc">
				<h3>Hiệu lực</h3>
				<div class="inside">
					<p><span>Từ</span><input type="text" 
					value="<%= datas[0].coupon_speciality_date_star %>" id="coupon_speciality_date_star" /> </p>
					<p><span>Đến</span><input type="text" 
					value="<%= datas[0].coupon_speciality_date_end %>" id="coupon_speciality_date_end" /> </p>
				</div>
			</div>
			
			<!-- Số lượng coupon -->
			<div class="pro_box">
				<h3>Số lượng coupon</h3>
				<div class="inside">
					<input type="text" 
					value="<%= datas[0].coupon_speciality_limit_number %>" id="coupon_speciality_limit_number" />
				</div>
			</div>
			
			<!-- Sử dụng chung coupon -->
			<div class="pro_box">
				<h3>Dùng chung với Coupon khác?</h3>
				<div class="inside">
					<select id="coupon_speciality_multiple">
						<%- ojs_share_coupon.show_coupon_multi_select(datas[0].coupon_speciality_multiple) %>
					</select>	
				</div>
			</div>




			<!-- --------------
			//ẩn hiện coupon
			---------------- -->			
			<div class="pro_box">
				<h3>Ẩn hiện ngoài app ? <a href="#"  target="_blank" class="giai_thich_link">
				<span class="giai-thich"><span>Cho ẩn hoặc hiện trên app khi khách mua hàng</span></span>	
				</a></h3>
				<div class="inside">
					<select id="coupon_speciality_show_hide">
						<%- ojs_share_coupon.show_coupon_show_hide(datas[0].coupon_speciality_show_hide) %>
					</select>	
				</div>									
			</div>				
			
			
			
			<!-- KH dùng tối đa -->
			<div class="pro_box">
				<h3>Mỗi khách dùng tối đa bao nhiêu lần?</h3>
				<div class="inside">
					<input 
						class="number_change" type="text" 
						data_value="<%= datas[0].coupon_speciality_limit_user %>"
						value="<%= ojs_share_all.show_price_format(datas[0].coupon_speciality_limit_user,0,",",".","") %>" 
						id="coupon_speciality_limit_user" 
					/>
				</div>
			</div>



	
			
			<!-- Trạng thái admin -->
			<div class="pro_box trang_thai_box ">
				<h3>Trạng thái admin</h3>
				<div class="inside">
					<select id="coupon_speciality_status_admin">
						<%- ojs_share_all.show_status_pay(datas[0].coupon_speciality_status_admin) -%>
					</select>						
				</div>
			</div>	


		</div>
	</div>
	
	<br>
	<br>
	<br>



	<div class="btn_box">
		<a href="/coupon/speciality/" class="btn_back">Quay về</a>
		<button id="btn_save" class="btn_save">Đăng</button>
	</div>	
		





	<input type="hidden" id="user_id" value="<%= user_id %>"/>
	<input type="hidden" id="store_id" value="<%= datas[0].coupon_speciality_stores_id_created %>"/>
	<input type="hidden" id="coupon_id" value="<%= coupon_id %>"/>


</div>
<!-- --------------------
end content
--------------------- -->





<%- include ("../../masterpage/footer") %>

</div><!-- //content_wrap -->	


<%- include ("../../masterpage/sidebar") %>

<!-- --------------------
//end of page wrap 
--------------------- -->
</div><!-- //layout -->	
</div><!-- //pagewrap -->


<script>
$(document).ready(function($){
/////////////////////////////////////////////////////	
	//
	
	var user_id = $('#user_id').val();
	var store_id = $('#store_id').val();
	var coupon_id = $('#coupon_id').val();
	
	
	
	//@
	ojs_share_upload.show_anh_dai_dien('featured_image','img_box_dai_dien',"","");
	//@
	//@	
	//@
	//@
	
	//@
	$(document).on('click','#btn_featured_image',function(e) {		
		e.preventDefault();		
		$('#upload_image').trigger( "click" );
	});
	
	
	
	
	
	//@
	$("#upload_image").on("change",function(){
		let input = this;
		ojs_share_upload.upload_anh_dai_dien(input,"featured_image","img_box_dai_dien",user_id)
	});		
	
	
	
	
	
	
	
	//
	//xóa image dai dien
	$(document).on('click','.xoaAnhDaiDien',function(e) {		
		e.preventDefault();		
		
		// xoa image s3
		let products_speciality_featured_image = $('#featured_image').attr("data_value");
		let url = products_speciality_featured_image;
		
		//console.log(url);
		//return;
		
		
		//ojs_share_upload.delete_s3(url);
		ojs_share_upload.delete_wp(url);
		$('#featured_image').attr("data_value","");
		//xoa html
		$(this).parent(".img_box").remove();
		ojs_share_upload.set_value_anh_dai_dien('featured_image','img_box_dai_dien');
	});			
	//		
	//		
	
	
	
	
	
	
	let date_s1 = $('#coupon_speciality_date_star').val();
	let date_s2 = $('#coupon_speciality_date_end').val();
		
	if(date_s1.length > 0){
		$( "#coupon_speciality_date_star" ).datepicker({
				dateFormat: "yy-mm-dd",
				timeFormat:  "hh:mm:ss",
				language: 'vi'
			}
		).datepicker ('setDate',  new Date (date_s1));
	}else{
		$( "#coupon_speciality_date_star" ).datepicker({
				dateFormat: "yy-mm-dd",
				timeFormat:  "hh:mm:ss",
				language: 'vi'
			}
		)		
	}
	
	if(date_s2.length > 0){	
		$( "#coupon_speciality_date_end" ).datepicker({
				dateFormat: "yy-mm-dd",
				timeFormat:  "hh:mm:ss",
				language: 'vi'
			}
		).datepicker ('setDate',  new Date (date_s2));
	}else{
		$( "#coupon_speciality_date_end" ).datepicker({
				dateFormat: "yy-mm-dd",
				timeFormat:  "hh:mm:ss",
				language: 'vi'
			}
		)		
	}


	//@ 
	//@
	//@
	//@ an hien thoi gian
	$(document).on('change','#coupon_speciality_time_type',function(e) {		
		e.preventDefault();
		var x = $(this).find("option:selected").val();
		if(x == 0){
			$('#hieu-luc').css('display','none');
		}else{
			$('#hieu-luc').css('display','block');
		}
	});


	$(document).on('change','#coupon_speciality_condition',function(e) {		
		e.preventDefault();
		var x = $(this).find("option:selected").val();
		if(x == 0 || x == 3){
			$('#gia_tri_dieu_kien_coupon').css('display','none');
		}else{
			$('#gia_tri_dieu_kien_coupon').css('display','block');
		}
	});

	$(document).on('change','#coupon_speciality_formula_price',function(e) {		
		e.preventDefault();
		var x = $(this).find("option:selected").val();
		if(x == 2){
			$('#gia_tri_cong_thuc_coupon').css('display','none');
		}else{
			$('#gia_tri_cong_thuc_coupon').css('display','block');
		}
	});




	
	//@
	//@
	//@
	//@
	$(document).on('click','#btn_save',function(e) {		
		e.preventDefault();
		var datas = get_datas();	
		
		//console.log(datas);
		//return;
		if(datas.datas.coupon_speciality_code == "" ){
			ojs_message.message_ok_show("Chưa nhập mã coupon");
			return;
		}
		
		//@ 
		//@ ngày tháng không để trống		
		if(datas.datas.coupon_speciality_time_type == 1 ){			
			if(datas.datas.coupon_speciality_date_star == "" 
			|| datas.datas.coupon_speciality_date_end == ""){
				ojs_message.message_ok_show("Vui lòng nhập ngày bắt đầu, ngày kết thúc");
				return;				
			}
		}		
		
		
		
		ojs_coupon_speciality_admin.ajax_update_admin(datas,coupon_id);	
	});


	
	
	function get_datas(){
		
		
		let coupon_speciality_code = $('#coupon_speciality_code').val();

		var date_01 = $('#coupon_speciality_date_star').datepicker( "getDate" );
		var coupon_speciality_date_star = $.datepicker.formatDate("yy-mm-dd", date_01);

		
		var date_02 = $('#coupon_speciality_date_end').datepicker( "getDate" );
		var coupon_speciality_date_end = $.datepicker.formatDate("yy-mm-dd", date_02);
		
		if(coupon_speciality_date_end.length > 0){			
			coupon_speciality_date_end = coupon_speciality_date_end + " 23:59:59"
		}
		

		let coupon_speciality_condition = $('#coupon_speciality_condition  option:selected').val();
		let coupon_speciality_condition_value = $('#coupon_speciality_condition_value').attr("data_value");
		
		
		let coupon_speciality_intro = $('#coupon_speciality_intro  option:selected').val();
		let coupon_speciality_marketing_return = $('#coupon_speciality_marketing_return').val();
		let coupon_speciality_intro_price = $('#coupon_speciality_intro_price').attr("data_value");		
		let coupon_speciality_intro_price_limit = $('#coupon_speciality_intro_price_limit').attr("data_value");			
		
		
		
		let coupon_speciality_formula_price = $('#coupon_speciality_formula_price  option:selected').val();
		let coupon_speciality_formula_price_value = $('#coupon_speciality_formula_price_value').attr("data_value");
		
		//@
		let coupon_speciality_featured_image = $('#featured_image').attr('data_value');	

		
		let coupon_speciality_price_max = $('#coupon_speciality_price_max').attr("data_value");
		let coupon_speciality_limit_user = $('#coupon_speciality_limit_user').val();
		let coupon_speciality_limit_number = $('#coupon_speciality_limit_number').val();		
		//@
		//@
		let coupon_speciality_type = $('#coupon_speciality_type  option:selected').val();
		let coupon_speciality_pay_type = $('#coupon_speciality_pay_type  option:selected').val();
		let coupon_speciality_multiple = $('#coupon_speciality_multiple  option:selected').val();	
		let coupon_speciality_show_hide = $('#coupon_speciality_show_hide  option:selected').val();
		let coupon_speciality_time_type = $('#coupon_speciality_time_type  option:selected').val();
		//@
		let coupon_speciality_info = $('#noi_dung').val();


		var coupon_speciality_status_admin = $('#coupon_speciality_status_admin').val();

		
		let datas = {
			"datas":{
				coupon_speciality_date_star : coupon_speciality_date_star,				
				coupon_speciality_date_end : coupon_speciality_date_end,				
				coupon_speciality_code : coupon_speciality_code,	
				
				coupon_speciality_condition : coupon_speciality_condition,				
				coupon_speciality_condition_value : coupon_speciality_condition_value,	
				
				coupon_speciality_formula_price : coupon_speciality_formula_price,
				coupon_speciality_formula_price_value : coupon_speciality_formula_price_value,	

				coupon_speciality_featured_image : coupon_speciality_featured_image,
				
				coupon_speciality_price_max : coupon_speciality_price_max,	
				coupon_speciality_type : coupon_speciality_type,
				coupon_speciality_pay_type : coupon_speciality_pay_type,				
								
								
				coupon_speciality_info : coupon_speciality_info,
				
				coupon_speciality_intro : coupon_speciality_intro,
				coupon_speciality_marketing_return : coupon_speciality_marketing_return,
				coupon_speciality_intro_price : coupon_speciality_intro_price,
				coupon_speciality_intro_price_limit : coupon_speciality_intro_price_limit,
				
				coupon_speciality_multiple : coupon_speciality_multiple,
				coupon_speciality_show_hide : coupon_speciality_show_hide,
				coupon_speciality_limit_user : coupon_speciality_limit_user,
				coupon_speciality_limit_number : coupon_speciality_limit_number,
				coupon_speciality_time_type : coupon_speciality_time_type,
				coupon_speciality_intro : coupon_speciality_intro,
				
				coupon_speciality_status_admin:coupon_speciality_status_admin,
				coupon_speciality_stores_id_created:store_id				
			}
		}
		
		return datas;
	}

	//
	//
///////////////////////////////////////////////////////
});//end of document
</script>



<%- include ("../../masterpage/loader-end") %>


























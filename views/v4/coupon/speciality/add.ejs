
<% if( typeof title == 'string' && title){ title = title } else{ title="" } %>


<% include ../../masterpage/loader %>

<script src="../../../../<%= js_css_version %>/javascripts/class-coupon-speciality.js"></script>		


<div id="page_wrap" class="page_wrap">
<div id="layout" class="page_width layout">
<div id="content-wrap" class="content_wrap">
<!-- --------------------
page wrap 
--------------------- -->
<% include ../../masterpage/header %>
<% include ../../masterpage/function-share-coupon %>




<script>
	console.log(<%- JSON.stringify({"datas_info" : datas_info}) %>);
</script>	







<% //neu admin thi hien muc nay
var	enable_text = " disabled " ;
var	enable_text2 = " " ;
var	enable_text3 = " disabled " ;

if(user_role =="admin"){ 
	enable_text3 = "" ;
	enable_text2 = " disabled "
}

%>






<!-- --------------------
content
--------------------- -->
<div id="content" class="content">

	<h1><a href="/coupon/speciality/<%= store_id %>/<%= user_id %>"><%= store_name %></a><i class="fas fa-chevron-right"></i>
	<a href="coupon/speciality/add/<%= store_id %>">coupon</a><i class="fas fa-chevron-right"></i>Tạo coupon</h1>
	
	<div class="noi_dung_coupon">
		<div class="thong_tin_coupon">	
	
			<p><span>Mã coupon</span><input type="text" value="" id="coupon_speciality_code" /> </p>
			<p><span>Ngày bắt đầu</span><input type="text" value="" id="coupon_speciality_date_star" /> </p>
			<p><span>Ngày kết thúc</span><input type="text" value="" id="coupon_speciality_date_end" /> </p>


				
			<p><span>Loại coupon<span>
				<select id="coupon_speciality_type">
					<%- ojs_share.show_coupon_type_select(0) %>
				</select>	
			</p>		
				

			<p>
			<span>Điều kiện<span>
				<select id="coupon_speciality_condition">
					<%- ojs_share_coupon.show_coupon_condition_select( 0 ) %>
					<input 
						class="number_change" type="text" 
						data_value="0"
						value="0" 
						id="coupon_speciality_condition_value" 
					/>
				</select>	
			</p>	
		</div>
		<div class="cong_thuc_coupon">
			<p>
			<span>Tên công thức<span>
				<select id="coupon_speciality_formula_price">
					<%- ojs_share_coupon.show_coupon_formula_select() %>
				</select>	
			</p>
		

			<p><span>Tiền giảm giá </span>
				<input 
					class="number_change" type="text" 
					data_value="0"
					value="0" 
					id="coupon_speciality_formula_price_value" 
				/>
			</p>
		</div>
		<div class="cong_thuc_coupon">
			<p><span>Giảm giá tối đa</span>
				<input 
					class="number_change" type="text" 
					data_value="0"
					value="0" 
					id="coupon_speciality_price_max" 
				/>
			</p>	
			
			<p><span>Số lượng dùng tối đa cho mỗi khách hàng</span>
				<input 
					class="number_change" type="text" 
					data_value="0"
					value="0" 
					id="coupon_speciality_limit_user" 
				/>
			</p>		

			<p>
			<span>Dùng chung với mã giảm giá khác<span>
				<select id="coupon_speciality_multiple">
					<%- ojs_share.show_coupon_multi_select(0) %>
				</select>	
			</p>

		</div>

	</div>
	
	<!-- ------------------
	Mô tả coupon
	------------------- -->
	<div class="value_row">
		<span>Mô tả coupon</span>
		<br>
		<textarea class="noi_dung"  id="noi_dung"  rows="20" cols="100%"></textarea>
	</div>
	<!-- ------------------
	//Mô tả danh mục
	------------------- -->	
	
	<div class="pro_box trang_thai_box ">
		<h3>Trạng thái admin</h3>
		<div class="inside">
			<span>ADMIN:</span><span class="giai-thich"><span>Khi thông tin sản phẩm đã sẵn sàng, chọn "đã phê duyệt" để hiển thị sản phẩm.</span></span>
			<select id="coupon_speciality_status_admin" <%= enable_text3 %>>
				<%- ojs_share.show_status_discount_programs(0) -%>
			</select>						
		</div>
	</div>		
	
	
	<div class="value_row">
		<span>quote</span>
		<br>
		<textarea class="quote"  id="coupon_speciality_qoute"  rows="10" cols="100%"></textarea>
	</div>
	
	
	

<div class="btn_box">
	<a href="/coupon/speciality/<%= store_id %>/" class="btn_back">Quay về</a>
	<a href="/coupon/speciality/<%= store_id %>/" class="btn_back" id="btn_draf">Lưu & Ẩn</a>
	<button id="btn_save" class="btn_save">Đăng</button>
</div>	
	





<input type="hidden" id="user_id" value="<%= user_id %>"/>
<input type="hidden" id="store_id" value="<%= store_id %>"/>



</div>
<!-- --------------------
end content
--------------------- -->





<% include ../../masterpage/footer %>

</div><!-- //content_wrap -->	


<% include ../../masterpage/sidebar %>

<!-- --------------------
//end of page wrap 
--------------------- -->
</div><!-- //layout -->	
</div><!-- //pagewrap -->


<script>
$(document).ready(function($){
/////////////////////////////////////////////////////	
	//
	
	var user_id = $('#user_id').val();
	var store_id = $('#store_id').val();
	
	
	
	$( "#coupon_speciality_date_star" ).datepicker({
			dateFormat: "yy-mm-dd",
			timeFormat:  "hh:mm:ss",
			language: 'vi'
		}
	);
	$( "#coupon_speciality_date_end" ).datepicker({
			dateFormat: "yy-mm-dd",
			timeFormat:  "hh:mm:ss",
			language: 'vi'
		}
	);

	//
	//@
	ojs_loader.loadTinyMCE('noi_dung',user_id);
		
		

	//@
	//@
	//@
	//@
	$(document).on('click','#btn_draf',function(e) {		
		e.preventDefault();
		var datas = get_datas();	
		
		datas.datas.coupon_speciality_status_admin = -1;
		
		//console.log(datas);
		//return;
		


		ojs_coupon_speciality.ajax_save(datas);	
	});
	
	//@
	//@
	//@
	//@
	$(document).on('click','#btn_save',function(e) {		
		e.preventDefault();
		var datas = get_datas();	
		//console.log(datas);
		//return;
		
		ojs_coupon_speciality.ajax_save(datas);	
	});


	
	
	function get_datas(){
		
		
		let coupon_speciality_code = $('#coupon_speciality_code').val();

		var date_01 = $('#coupon_speciality_date_star').datepicker( "getDate" );
		var coupon_speciality_date_star = $.datepicker.formatDate("yy-mm-dd", date_01);

		
		var date_02 = $('#coupon_speciality_date_end').datepicker( "getDate" );
		var coupon_speciality_date_end = $.datepicker.formatDate("yy-mm-dd", date_02);
		
		if(coupon_speciality_date_end.length > 0){			
			coupon_speciality_date_end = coupon_speciality_date_end + " 23:59:59"
		}
		
		if(coupon_speciality_code == "" ){
			ojs_message.message_ok_show("Chưa nhập mã coupon");
		}

		

		let coupon_speciality_condition = $('#coupon_speciality_condition  option:selected').val();
		let coupon_speciality_condition_value = $('#coupon_speciality_condition_value').attr("data_value");
		
		let coupon_speciality_formula_price = $('#coupon_speciality_formula_price  option:selected').val();
		let coupon_speciality_formula_price_value = $('#coupon_speciality_formula_price_value').attr("data_value");
		
		
		let coupon_speciality_price_max = $('#coupon_speciality_price_max').attr("data_value");
		let coupon_speciality_limit_user = $('#coupon_speciality_limit_user').val();
			
		//@
		//@
		let coupon_speciality_type = $('#coupon_speciality_type  option:selected').val();
		let coupon_speciality_multiple = $('#coupon_speciality_multiple  option:selected').val();	
		//@
		let coupon_speciality_info = tinymce.get("noi_dung").getContent();
		var coupon_speciality_status_admin = $('#coupon_speciality_status_admin').val();





		
		let datas = {
			"datas":{
				coupon_speciality_date_star : coupon_speciality_date_star,				
				coupon_speciality_date_end : coupon_speciality_date_end,				
				coupon_speciality_code : coupon_speciality_code,	
				
				coupon_speciality_condition : coupon_speciality_condition,				
				coupon_speciality_condition_value : coupon_speciality_condition_value,	
				
				coupon_speciality_formula_price : coupon_speciality_formula_price,
				coupon_speciality_formula_price_value : coupon_speciality_formula_price_value,	

				
				coupon_speciality_price_max : coupon_speciality_price_max,	
				coupon_speciality_type : coupon_speciality_type,				
								
								
				coupon_speciality_info : coupon_speciality_info,				
				coupon_speciality_multiple : coupon_speciality_multiple,
				coupon_speciality_limit_user : coupon_speciality_limit_user,
				
				coupon_speciality_status_admin:coupon_speciality_status_admin,
				coupon_speciality_stores_id_created:store_id				
			}
		}
		
		return datas;
	}

	//
	//
///////////////////////////////////////////////////////
});//end of document
</script>



<% include ../../masterpage/loader-end %>
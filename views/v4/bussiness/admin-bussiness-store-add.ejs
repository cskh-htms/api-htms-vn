
<% if( typeof title == 'string' && title){ title = title } else{ title="" } %>


<% include ../masterpage/loader %>


<script src="../../../../<%= js_css_version %>/javascripts/class-bussiness.js"></script>	

<div id="page_wrap" class="page_wrap">
<div id="layout" class="page_width layout">
<div id="content-wrap" class="content_wrap">
<!-- --------------------
page wrap 
--------------------- -->
<% include ../masterpage/header %>

<script>
	console.log(<%- JSON.stringify({"datas_info" : datas_info}) %>);
</script>	

<!-- --------------------
content
--------------------- -->
<div id="content" class="content user_edit">

	<h1><a href="/admin/">Admin</a><i class="fas fa-chevron-right"></i><a href="/stores/">Cửa hàng</a><i class="fas fa-chevron-right"></i><%= title %></h1>
	<div class="store_content">
	<div class="white_box">
		<p><span>Tên cửa hàng</span><input type="text" class= "" value="" id="stores_name"/></p>
		<br>
		
		</br>
		<div class="select-box-tinh-thanh">
		<span>Tỉnh thành</span>
		<select id="select_stores_province">
			<option value="0"></option>
		</select>
		<p style="display:none"><span>Tỉnh thành</span><input type="text" data_value="" value="" id="stores_province"/></p>
		</div>
		
		</br>
		<div class="select-box-tinh-thanh">
		<span>Tỉnh thành</span>
		<select id="select_stores_district">
			<option value="0"></option>
		</select>	
		<p style="display:none"><span>Quận huyện</span><input type="text" data_value="" value="" id="stores_district"/></p>
		</div>
		
		
		<br>
		<div class="select-box-tinh-thanh">
		<span>Phường xã</span>
		<select id="select_stores_wards">
			<option value="0"></option>
		</select>		
		<p style="display:none"><span>Phường xã</span><input type="text" data_value="" value="" id="stores_wards"/></p>
		</div>
		
		
		<p><span>Số nhà, tên đường</span><input type="text" class= "" value="" id="stores_adress"/></p>
		<p><span>Tọa độ x</span><input type="text" class= "" value="" id="stores_local_x"/>
		<span class="giai-thich"><span>Vào <a href="https://www.google.com/maps" target="_blank">Google Map</a> ấn chuột phải vào vị trí cửa hàng của mình và chọn dãy số X,Y để copy.</span></span></p>
		<p><span>Tọa độ y</span><input type="text" class= "" value="" id="stores_local_y"/></p>
		<p style="display:none"><span>Local address</span><input type="text" class= "" value="" id="stores_local_adress"/><span class="giai-thich"><span>không bắt buộc</span></span></p>
		<br>
		<br>
		<p style="display:none"><span>giới hạn upload hình trong ngày</span><input type="text" class= "" value="20" id="stores_upload_limit_day"/></p>
		<p style="display:none"><span>giới hạn upload hình trong tháng</span><input type="text" class= "" value="300" id="stores_upload_limit_month"/></p>
	</div>
	<div class="white_box">


		<div id="loai_service_wrap">
		<span>Loại dịch vụ</span>
		<select name="stores_service_type_id" id="stores_service_type_id">
			<option value="0">Chọn dịch vụ</option>
			<% include ../masterpage/widget-service-type %>
		</select>
		<span class="giai-thich"><span>Special: đặc sản, food-drink: quán nước</span></span>
		</div>	

		
		<p>
			<span>Hạn mức thanh toán</span>
			<input type="text" class= "number_change" 
				data_value="10000000" 
				value="10.000.000" 
				id="stores_payment_limit"
			/>
			<span class="giai-thich"><span>Khi doanh số đạt hạn mức, Dala sẽ chuyển khoản cho cửa hàng.</span></span>
		</p>
		
		
		<p>
			<span>Thông tin chuyển khoản</span>
			<textarea id="stores_info_banking" class="area365" rows="10" cols="100%" placeholder="Nhập số tài khoản, ngân hàng và tên chủ tài khoản."></textarea>
		</p>	
		
		
		
		<p>
		<span>Trạng thái cửa hàng:</span>
		<select id="stores_status_admin">
			<%- ojs_share.show_status_product() %>
		</select>
		<span class="giai-thich"><span>Cửa hàng đã kích hoạt hay chưa, chọn "đã phê duyệt" để hiển kích hoạt cửa hàng.</span></span>
		</p>
		
		
		<!-- -----------
		//chon user
		-------------- -->
		
		<p>
		<span>Chọn TK doanh nghiệp</span>
		<select id="stores_user_id">
			<option value="0">Chọn một tài khoản</option>
		<%
		for(var i = 0; i < users_list.length; i ++){ %>
			<option value="<%= users_list[i].users_ID %>"><%= users_list[i].users_full_name %></option>
		<%	
		}
		%>
		
		
		</select>
		<span class="giai-thich"><span>Tài khoản doanh nghiệp</span></span>
		</p>		
		
		
		<!-- -----------
		//chon user
		-------------- -->		
		
		<!--
		<p>
			<span>Lời nhắn</span>
			<textarea id="stores_qoute" class="area365" rows="10" cols="100%" placeholder="Trong quá trình xét duyệt cửa hàng, nếu lỗi admin sẽ để lại lời nhắn ở đây."></textarea>
		</p> 
		-->
	</div>
	</div>
	
	
	

<div class="btn_box">
	<button id="btn_save" class="btn_save">Lưu</button>
</div>	
	





<input type="hidden" id="user_id" value="<%= user_id %>"/>







</div>
<!-- --------------------
//end content
--------------------- -->





<% include ../masterpage/footer %>

</div><!-- //content_wrap -->	


<% include ../masterpage/sidebar %>

<!-- --------------------
//end of page wrap 
--------------------- -->
</div><!-- //layout -->	
</div><!-- //pagewrap -->


<script>
$(document).ready(function($){
/////////////////////////////////////////////////////	
	//

	
	
	// ajax luu san pham
	$(document).on('click','#btn_save',function(e) {		
		e.preventDefault();
		//alert("hú hú");
		//return;
		
		
		
		
		
			
		//@
		var stores_name = $('#stores_name').val();
		var stores_user_id = $('#stores_user_id  option:selected').val();
		
		
		
		
		var stores_info_banking = $('#stores_info_banking').val();
		var stores_qoute = $('#stores_qoute').val();
		
		var stores_status_admin = $('#stores_status_admin  option:selected').val();
		
		var stores_payment_limit = $('#stores_payment_limit').attr("data_value");		
		
		
		var stores_province = $('#stores_province').attr("data_value");
		var stores_district = $('#stores_district').attr("data_value");
		var stores_wards = $('#stores_wards').attr("data_value");
		var stores_adress = $('#stores_adress').val();
		
		
		
		var stores_local_x = $('#stores_local_x').val();
		var stores_local_y = $('#stores_local_y').val();
		var stores_local_adress = $('#stores_local_adress').val();
		
		
		var stores_service_type_id = $('#stores_service_type_id  option:selected').val();		
		if(stores_service_type_id == 0  || stores_service_type_id == "0"){
			ojs_message.message_ok_show("chọn loại service");
			return;
		}
		
		if(stores_user_id == 0  || stores_user_id == "0"){
			ojs_message.message_ok_show("chọn một tài khoản doanh nghiệp");
			return;
		}		
		
		//@
		
		//@
		//@

		//
		var datas = {
			"datas":{
				stores_name : stores_name,
				stores_user_id: stores_user_id,
				stores_service_type_id : stores_service_type_id,
				stores_province : stores_province,
				stores_district : stores_district,
				stores_wards : stores_wards,
				stores_adress : stores_adress,
				stores_local_x : stores_local_x,
				stores_local_y : stores_local_y,
				stores_local_adress : stores_local_adress,		
				stores_payment_limit : stores_payment_limit,
				stores_info_banking : stores_info_banking,
				stores_qoute : stores_qoute,
				stores_status_admin : stores_status_admin,
				stores_status_stores : 1,
			}
		}
		
		
		//console.log(datas);		
		//return;
		
		ojs_bussiness.ajax_save(datas);	
		
		
		
		
		
	});//end of save ajax
	
	
	
	$.getJSON( "../../../../uploads/files/local.json", function( datas ) {
		//console.log(datas);
		var tinh_thanh = ojs_loader.get_tinh_thanh(datas);
		$('#select_stores_province').html(tinh_thanh);
		ojs_loader.tinh_thanh_datas = datas;
		console.log(ojs_loader.tinh_thanh_datas);
	});
	
	// thay đổi quận huyện
	$(document).on('change','#select_stores_province',function(e) {		
		e.preventDefault();
		

		//@		
		var taget = $(this).val();
		var quan_huyen =  ojs_loader.get_quan_huyen(ojs_loader.tinh_thanh_datas,taget);
		
		$('#select_stores_district').html(quan_huyen);
		$('#select_stores_wards').html('<option value="0"></option>');
		
		//@
		//@		
		ojs_loader.set_value_local();
		//return;	
	});//end of
	//
	// thay đổi quận huyện
	$(document).on('change','#select_stores_district',function(e) {		
		e.preventDefault();
		
		var taget = $(this).val();
		var phuong_xa =  ojs_loader.get_phuong_xa(ojs_loader.tinh_thanh_datas,taget);
		
		$('#select_stores_wards').html(phuong_xa);
		
		//@
		//@		
		ojs_loader.set_value_local();		
		//return;	
	});//end of	
	
	
	//
	// thay đổi quận huyện
	$(document).on('change','#select_stores_wards',function(e) {		
		e.preventDefault();
		//@
		//@		
		ojs_loader.set_value_local();		
		//return;	
	});//end of		
	
	//
///////////////////////////////////////////////////////
});//end of document
</script>



<% include ../masterpage/loader-end %>